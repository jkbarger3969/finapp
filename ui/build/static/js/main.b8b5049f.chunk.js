(this.webpackJsonpaccounting=this.webpackJsonpaccounting||[]).push([[0],{391:function(e){e.exports=JSON.parse('{"__schema":{"types":[{"kind":"UNION","name":"BudgetOwner","possibleTypes":[{"name":"Department"},{"name":"Business"}]},{"kind":"UNION","name":"DepartmentAncestor","possibleTypes":[{"name":"Department"},{"name":"Business"}]},{"kind":"UNION","name":"PaymentMethodAuthorizedEntity","possibleTypes":[{"name":"Person"},{"name":"Business"},{"name":"Department"}]},{"kind":"UNION","name":"JournalEntrySource","possibleTypes":[{"name":"Person"},{"name":"Business"},{"name":"Department"}]}]}}')},5660:function(e,n,t){e.exports=t(5765)},5765:function(e,n,t){"use strict";t.r(n);var a=t(0),r=t.n(a),l=t(29),o=t.n(l),i=t(70),u=t(5803),c=t(117),d=t(131),s=t(302),m=t(391),p=new s.b({introspectionQueryResultData:m}),f=new s.a({fragmentMatcher:p,addTypename:!0}),b=t(15),v=t(16),y=t.n(v);function E(){var e=Object(b.a)(["\n\n  type LC_JournalEntryUpsertSource {\n    sourceType:JournalEntrySourceType!\n    id:ID!\n  }\n\n  type LC_JournalEntryUpsertFields {\n    id:ID\n    date:String\n    department:[ID!]!\n    type:ID\n    paymentMethod:ID\n    total:Rational\n    source:[LC_JournalEntryUpsertSource!]!\n  }\n\n  type LC_JournalEntryUpsertInputValues {\n    deptInput:String\n    totalInput:String\n    srcInput:String\n    srcType:JournalEntrySourceType\n  }\n\n  type LC_JournalEntryUpsertInputErrors {\n    dateError:String\n    deptError:String\n    typeError:String\n    payMethodError:String\n    totalError:String\n    srcError:String\n  }\n\n  enum LC_JournalEntryUpsertSubmitStatus {\n    NOT_SUBMITTED\n    SUBMITTING\n    SUBMITTED\n  }\n\n  enum LC_JournalEntryUpsertType {\n    UPDATE\n    ADD\n  }\n\n  type LC_JournalEntryUpsert {\n    id:ID!\n    valid:Boolean!\n    type:LC_JournalEntryUpsertType!\n    submitStatus:LC_JournalEntryUpsertSubmitStatus!\n    submitError:String\n    inputValues:LC_JournalEntryUpsertInputValues!\n    inputErrors:LC_JournalEntryUpsertInputErrors!\n    fields:LC_JournalEntryUpsertFields!\n  }\n\n  extend type Query {\n    lc_journalEntryUpserts:[LC_JournalEntryUpsert!]!\n  }\n  \n"]);return E=function(){return e},e}var O,j,g,h,R,C,M,_,I=[y()(E())],k={},A=t(411),S=t(393),w=t(57),x=t(395),D=t(155),F=new A.a({uri:"/graphql",credentials:"same-origin"}),T=new S.a({uri:"ws://".concat(window.location.host,"/graphql"),options:{reconnect:!0}}),P=w.a.from([Object(x.a)((function(e){var n=e.graphQLErrors,t=e.networkError;n&&n.forEach((function(e){var n=e.message,t=e.locations,a=e.path;return console.error("[GraphQL error]: Message: ".concat(n,", Location: ").concat(t,", Path: ").concat(a))})),t&&console.log("[Network error]: ".concat(t))})),w.a.split((function(e){var n=e.query,t=Object(D.a)(n);return"OperationDefinition"===t.kind&&"subscription"===t.operation}),T,F)]),$=new d.a({link:P,cache:f,typeDefs:I,resolvers:k}),U=t(130),N=t(36),J=t(71),B=t(12),L=t(20),V=t.n(L),W=t(48),z=t(187),q=t.n(z),G=t(23),K=t(61),X=t.n(K),Q=t(5836),H=t(132),Y=t(5832),Z=t(5833),ee=t(5830),ne=t(5813),te=t(5831),ae=t(288),re=t(361),le=t(362),oe=t(358),ie=t(58),ue=t(164),ce=t(161),de=t(112),se=t(410);function me(){var e=Object(b.a)(["\n  subscription JournalEntryUpdated_1 {\n    journalEntryUpdated {\n      ...JournalEntry_1Fragment\n    }\n  }\n  ","\n"]);return me=function(){return e},e}function pe(){var e=Object(b.a)(["\n  subscription JournalEntryAdded_1 {\n    journalEntryAdded {\n      ...JournalEntry_1Fragment\n    }\n  }\n  ","\n"]);return pe=function(){return e},e}function fe(){var e=Object(b.a)(['\n  query JournalEntries_1($where: JournalEntiresWhereInput!) {\n    journalEntries(where: $where)\n      @connection(key: "JournalEntries_1", filter: ["where"]) {\n      ...JournalEntry_1Fragment\n    }\n  }\n  ',"\n"]);return fe=function(){return e},e}function be(){var e=Object(b.a)(["\n  fragment JournalEntry_1Fragment on JournalEntry {\n    __typename\n    id\n    date\n    department {\n      __typename\n      id\n      name\n      ancestors {\n        __typename\n        ... on Business {\n          id\n          bizName: name\n        }\n        ... on Department {\n          id\n          deptName: name\n        }\n      }\n    }\n    type\n    category {\n      ...JournalEntryCategory_1Fragment\n    }\n    department {\n      ...JournalEntryDept_1Fragment\n    }\n    description\n    paymentMethod {\n      ...JournalEntryPayMethod_1Fragment\n    }\n    source {\n      __typename\n      ... on Person {\n        id\n        name {\n          first\n          last\n        }\n      }\n      ... on Business {\n        id\n        bizName: name\n      }\n      ... on Department {\n        id\n        deptName: name\n      }\n    }\n    total {\n      n\n      d\n      s\n    }\n    refunds {\n      ...JournalEntryRefund_1Fragment\n    }\n    items {\n      ...JournalEntryItem_1Fragment\n    }\n    deleted\n    lastUpdate\n    reconciled\n  }\n  ","\n  ","\n  ","\n  ","\n  ","\n"]);return be=function(){return e},e}function ve(){var e=Object(b.a)(["\n  fragment JournalEntryItem_1Fragment on JournalEntryItem {\n    __typename\n    id\n    category {\n      ...JournalEntryCategory_1Fragment\n    }\n    department {\n      ...JournalEntryDept_1Fragment\n    }\n    total {\n      n\n      d\n      s\n    }\n    units\n    description\n    lastUpdate\n    deleted\n  }\n  ","\n  ","\n"]);return ve=function(){return e},e}function ye(){var e=Object(b.a)(["\n  fragment JournalEntryRefund_1Fragment on JournalEntryRefund {\n    __typename\n    id\n    date\n    description\n    total {\n      n\n      d\n      s\n    }\n    paymentMethod {\n      ...JournalEntryPayMethod_1Fragment\n    }\n    reconciled\n    lastUpdate\n    deleted\n  }\n  ","\n"]);return ye=function(){return e},e}function Ee(){var e=Object(b.a)(["\n  fragment JournalEntryDept_1Fragment on Department {\n    __typename\n    id\n    name\n    ancestors {\n      __typename\n      ... on Business {\n        id\n        bizName: name\n      }\n      ... on Department {\n        id\n        deptName: name\n      }\n    }\n  }\n"]);return Ee=function(){return e},e}function Oe(){var e=Object(b.a)(["\n  fragment JournalEntryCategory_1Fragment on JournalEntryCategory {\n    __typename\n    id\n    type\n    name\n  }\n"]);return Oe=function(){return e},e}function je(){var e=Object(b.a)(["\n  fragment JournalEntryPayMethod_1Fragment on PaymentMethod {\n    __typename\n    id\n    name\n    parent {\n      __typename\n      id\n    }\n  }\n"]);return je=function(){return e},e}!function(e){e.Public="PUBLIC",e.Private="PRIVATE"}(O||(O={})),function(e){e.Include="INCLUDE",e.Exclude="EXCLUDE"}(j||(j={})),function(e){e.Business="BUSINESS",e.Department="DEPARTMENT",e.Person="PERSON"}(g||(g={})),function(e){e.Credit="CREDIT",e.Debit="DEBIT"}(h||(h={})),function(e){e.NotSubmitted="NOT_SUBMITTED",e.Submitting="SUBMITTING",e.Submitted="SUBMITTED"}(R||(R={})),function(e){e.Update="UPDATE",e.Add="ADD"}(C||(C={})),function(e){e.Pos="POS",e.Neg="NEG"}(M||(M={})),function(e){e.Asc="ASC",e.Desc="DESC"}(_||(_={}));var ge=y()(je()),he=y()(Oe()),Re=y()(Ee()),Ce=y()(ye(),ge),Me=y()(ve(),he,Re),_e=y()(be(),ge,Re,he,Ce,Me),Ie=y()(fe(),_e),ke=(y()(pe(),_e),y()(me(),_e),"5dc46d0af74afb2c2805bd54"),Ae=t(5808),Se=t(5809),we=t(5810),xe=t(5811),De=t(5812),Fe=t(5814),Te=t(5815),Pe=t(5816),$e=t(5817),Ue=t(5818),Ne=t(5819),Je=t(5820),Be=t(5821),Le=t(5822),Ve={Add:Object(a.forwardRef)((function(e,n){return r.a.createElement(Ae.a,Object.assign({},e,{ref:n}))})),Check:Object(a.forwardRef)((function(e,n){return r.a.createElement(Se.a,Object.assign({},e,{ref:n}))})),Clear:Object(a.forwardRef)((function(e,n){return r.a.createElement(we.a,Object.assign({},e,{ref:n}))})),Delete:Object(a.forwardRef)((function(e,n){return r.a.createElement(xe.a,Object.assign({},e,{ref:n}))})),DetailPanel:Object(a.forwardRef)((function(e,n){return r.a.createElement(De.a,Object.assign({},e,{ref:n}))})),Edit:Object(a.forwardRef)((function(e,n){return r.a.createElement(ne.a,Object.assign({},e,{ref:n}))})),Export:Object(a.forwardRef)((function(e,n){return r.a.createElement(Fe.a,Object.assign({},e,{ref:n}))})),Filter:Object(a.forwardRef)((function(e,n){return r.a.createElement(Te.a,Object.assign({},e,{ref:n}))})),FirstPage:Object(a.forwardRef)((function(e,n){return r.a.createElement(Pe.a,Object.assign({},e,{ref:n}))})),LastPage:Object(a.forwardRef)((function(e,n){return r.a.createElement($e.a,Object.assign({},e,{ref:n}))})),NextPage:Object(a.forwardRef)((function(e,n){return r.a.createElement(De.a,Object.assign({},e,{ref:n}))})),PreviousPage:Object(a.forwardRef)((function(e,n){return r.a.createElement(Ue.a,Object.assign({},e,{ref:n}))})),ResetSearch:Object(a.forwardRef)((function(e,n){return r.a.createElement(we.a,Object.assign({},e,{ref:n}))})),Search:Object(a.forwardRef)((function(e,n){return r.a.createElement(Ne.a,Object.assign({},e,{ref:n}))})),SortArrow:Object(a.forwardRef)((function(e,n){return r.a.createElement(Je.a,Object.assign({},e,{ref:n}))})),ThirdStateCheck:Object(a.forwardRef)((function(e,n){return r.a.createElement(Be.a,Object.assign({},e,{ref:n}))})),ViewColumn:Object(a.forwardRef)((function(e,n){return r.a.createElement(Le.a,Object.assign({},e,{ref:n}))}))},We=t(24),ze=t(30),qe=t(5779),Ge=t(5805),Ke=t(5804),Xe=t(5781),Qe=t(5796),He=t(5782),Ye=t(146),Ze=t(5826),en=t(5827),nn=t(35),tn=t.n(nn);function an(){var e=Object(b.a)(["\n  mutation AddEntryRefund(\n    $id: ID!\n    $fields: JournalEntryAddRefundFields!\n    $paymentMethodAdd: PaymentMethodAddFields\n  ) {\n    journalEntryAddRefund(\n      id: $id\n      fields: $fields\n      paymentMethodAdd: $paymentMethodAdd\n    ) {\n      id\n      __typename\n      refunds {\n        ...JournalEntryRefund_1Fragment\n      }\n    }\n  }\n  ","\n"]);return an=function(){return e},e}var rn,ln=y()(an(),Ce),on=function(){var e=Object(N.a)(V.a.mark((function e(n,t,a){var r,l,o,i,u,c;return V.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=function(){var e=a.paymentMethod.value[a.paymentMethod.value.length-1];return"string"===typeof e?{paymentMethod:"",paymentMethodAdd:{parent:a.paymentMethod.value[a.paymentMethod.value.length-2].id,refId:e,name:e,active:!1}}:{paymentMethod:e.id,paymentMethodAdd:null}}(),i=o.paymentMethod,u=o.paymentMethodAdd,c={id:t,fields:{date:a.date.value,description:(null===(r=a.description)||void 0===r?void 0:r.trim())?a.description.trim():null,paymentMethod:i,total:a.total.value,reconciled:null!==(l=a.reconciled)&&void 0!==l?l:null},paymentMethodAdd:u},e.next=4,n.mutate({mutation:ln,variables:c});case 4:case"end":return e.stop()}}),e)})));return function(n,t,a){return e.apply(this,arguments)}}(),un=t(39),cn=t(286),dn=t(228),sn=t(166),mn=t(5823),pn=t(5824),fn=t(5825),bn=function(e){return function(n){for(var t=arguments.length,a=new Array(t>1?t-1:0),r=1;r<t;r++)a[r-1]=arguments[r];return{inputValue:n,value:e.apply(void 0,[n].concat(a))}}};!function(e){e[e.NOTIFICATION=0]="NOTIFICATION",e[e.ERROR=1]="ERROR",e[e.FATAL_ERROR=2]="FATAL_ERROR"}(rn||(rn={}));var vn=function(){var e=Object(We.c)(),n=e.setStatus,t=e.status,r=Object(a.useCallback)((function(e){t?e&&!Object.keys(e).some((function(n){return e[n]!==t[n]}))||n(e):e&&n(e)}),[n,t]);return[null!==t&&void 0!==t?t:null,r]},yn={inputMode:"numeric"},En={tabIndex:-1},On=bn((function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];var a=n[0],r=n[1];return a&&Object(sn.a)(a)?Object(mn.a)(a):r||""})),jn=function(e){var n,t,l,o=e.variant,i=void 0===o?"filled":o,u=e.autoFocus,c=void 0!==u&&u,d=e.disabled,s=void 0!==d&&d,m=e.maxDate,p=void 0===m?new Date:m,f=e.minDate,b=Object(We.c)().isSubmitting,v=Object(a.useCallback)((function(e){var n=((null===e||void 0===e?void 0:e.value)||"").trim();if(!n)return"Date is Required";var t=Object(pn.a)(n);return Object(sn.a)(t)?f&&t<f?"Cannot be before ".concat(Object(se.a)(f,"MM/dd/yyyy")):p<t?"Cannot be after ".concat(Object(se.a)(p,"MM/dd/yyyy")):void 0:"Invalid Date"}),[f,p]),y=Object(We.b)({name:"date",validate:v}),E=Object(B.a)(y,3),O=E[0],j=E[1],g=E[2],h=null!==(n=null===(t=O.value)||void 0===t?void 0:t.inputValue)&&void 0!==n?n:null,R=j.error,C=j.touched,M=g.setValue,_=g.setTouched,I=null===(l=j.initialValue)||void 0===l?void 0:l.inputValue,k=Object(a.useMemo)((function(){return I&&Object(sn.a)(I)?I:new Date}),[I]),A=Object(a.useMemo)((function(){return{autoFocus:c}}),[c]),S=Object(a.useRef)(!1),w=Object(a.useCallback)((function(){return setTimeout((function(){S.current||_(!0)}),0)}),[_,S]),x=Object(a.useCallback)((function(){return S.current=!0}),[S]),D=Object(a.useCallback)((function(){S.current=!1,w()}),[S,w]),F=Object(a.useCallback)((function(e,n){M(On(e&&Object(sn.a)(e)?Object(fn.a)([new Date,e]):e,n))}),[M]),T=vn(),P=Object(B.a)(T,1)[0],$=Object(a.useMemo)((function(){return Object(W.a)({},O,{disabled:b||s||(null===P||void 0===P?void 0:P.type)===rn.FATAL_ERROR,value:h,error:C&&!!R,helperText:C?R:void 0,animateYearScrolling:!0,disableToolbar:!0,disableFuture:!0,inputVariant:i,variant:"inline",format:"MM/dd/yyyy",margin:"none",label:"Date",initialFocusedDate:k,autoOk:!0,InputProps:A,inputProps:yn,placeholder:"mm/dd/yyyy",KeyboardButtonProps:En,onBlur:w,onOpen:x,onClose:D,onChange:F})}),[h,k,w,R,i,A,b,O,x,D,F,C,s,P]);return r.a.createElement(un.a,{utils:dn.default},r.a.createElement(cn.b,Object.assign({maxDate:p},e,$)))},gn=t(41),hn=t(246),Rn=function(e){var n,t=e.autoFocus,l=void 0!==t&&t,o=e.disabled,i=void 0!==o&&o,u=e.variant,c=void 0===u?"filled":u,d=Object(gn.a)(e,["autoFocus","disabled","variant"]),s=Object(We.b)({name:"description"}),m=Object(B.a)(s,3),p=m[0],f=m[2].setValue,b=Object(a.useCallback)((function(e){var n,t;f((null===e||void 0===e||null===(n=e.target)||void 0===n||null===(t=n.value)||void 0===t?void 0:t.trimLeft())||null)}),[f]),v=Object(a.useMemo)((function(){return{type:"text",autoFocus:l}}),[l]),y=vn(),E=Object(B.a)(y,1)[0];return r.a.createElement(hn.a,Object.assign({},d,p,{disabled:i||(null===E||void 0===E?void 0:E.type)===rn.FATAL_ERROR,onChange:b,value:null!==(n=p.value)&&void 0!==n?n:"",variant:c,label:"Description",name:"description",InputProps:v}))},Cn=t(294),Mn=function(e){return{n:Math.abs(e.n),d:Math.abs(e.d),s:-1===e.s?M.Neg:M.Pos}},_n=function(e){return new tn.a({n:e.s===M.Neg?-Math.abs(e.n):Math.abs(e.n),d:Math.abs(e.d)})},In={min:"0.00",step:"0.01"},kn=bn((function(e){return"string"!==typeof e||e.trim()?Mn(new tn.a(e).round(2)):Mn(new tn.a(0))})),An=function(e){var n,t,l=e.autoFocus,o=void 0!==l&&l,i=e.disabled,u=void 0!==i&&i,c=e.variant,d=void 0===c?"filled":c,s=e.maxTotal,m=void 0===s?new tn.a(Number.MAX_SAFE_INTEGER):s,p=e.minTotal,f=void 0===p?new tn.a(0):p,b=Object(gn.a)(e,["autoFocus","disabled","variant","maxTotal","minTotal"]),v=new tn.a(1,100).compare(f)>0?new tn.a(1,100):f,y=Object(a.useCallback)((function(e){var n,t;if(!e||null===(n=null===(t=e.inputValue)||void 0===t?void 0:t.trim())||void 0===n||!n)return"Total Required";var a=_n(e.value);return Number.isNaN(Number.parseInt(e.inputValue))?"Invalid Number":a.compare(m)>0?"Cannot be greater than ".concat(X()(m.valueOf()).format("$0,0.00")):0===a.compare(new tn.a(0))?"Cannot be 0":a.compare(v)<0?"Cannot be less than ".concat(X()(v.valueOf()).format("$0,0.00")):void 0}),[v,m]),E=Object(We.b)({name:"total",validate:y}),O=Object(B.a)(E,3),j=O[0],g=O[1],h=O[2].setValue,R=null!==(n=null===(t=j.value)||void 0===t?void 0:t.inputValue)&&void 0!==n?n:"",C=g.error,M=g.touched,_=Object(a.useMemo)((function(){return{type:"number",autoFocus:o,startAdornment:r.a.createElement(Cn.a,{position:"start"},"$")}}),[o]),I=Object(a.useCallback)((function(e){var n,t;h(kn((null===e||void 0===e||null===(n=e.target)||void 0===n||null===(t=n.value)||void 0===t?void 0:t.toString())||""))}),[h]),k=Object(a.useMemo)((function(){var e=new tn.a(Number.MAX_SAFE_INTEGER),n=new tn.a(1,100);return M&&C?C:0!==m.compare(e)&&v.compare(n)>0?"Max ".concat(X()(m.valueOf()).format("$0,0.00")," & Min ").concat(X()(v.valueOf()).format("$0,0.00")):0!==m.compare(e)?"Max ".concat(X()(m.valueOf()).format("$0,0.00")):v.compare(n)>0?"Min ".concat(X()(v.valueOf()).format("$0,0.00")):""}),[M,C,m,v]),A=vn(),S=Object(B.a)(A,1)[0];return r.a.createElement(hn.a,Object.assign({},b,j,{disabled:u||(null===S||void 0===S?void 0:S.type)===rn.FATAL_ERROR,type:"number",value:R,error:M&&!!C,helperText:k,placeholder:"0.00",label:"Total",name:"total",required:!0,variant:d,inputProps:In,InputProps:_,onChange:I}))},Sn=t(376),wn=t(386),xn={type:"checkbox"},Dn=function(e){var n,t=e.label,a=e.disabled,l=void 0!==a&&a,o=Object(gn.a)(e,["label","disabled"]),i=Object(We.b)({name:"reconciled",type:"checkbox"}),u=Object(B.a)(i,1)[0],c=null!==(n=u.value)&&void 0!==n&&n,d=vn(),s=Object(B.a)(d,1)[0];return t?r.a.createElement(Sn.a,Object.assign({},o,u,{value:c,disabled:l||(null===s||void 0===s?void 0:s.type)===rn.FATAL_ERROR,label:"Reconcile",control:r.a.createElement(wn.a,{inputProps:xn})})):r.a.createElement(wn.a,Object.assign({},o,u,{value:c,disabled:l||(null===s||void 0===s?void 0:s.type)===rn.FATAL_ERROR,inputProps:xn}))},Fn=t(389);function Tn(){var e=Object(b.a)(["\n  fragment PayMethodEntryOptFragment on PaymentMethod {\n    __typename\n    id\n    refId\n    name\n    active\n    parent {\n      __typename\n      id\n    }\n  }\n"]);return Tn=function(){return e},e}function Pn(){var e=Object(b.a)(["\n  fragment SrcEntryBizOptFragment on Business {\n    __typename\n    id\n    name\n    vendor {\n      approved\n      vendorId\n    }\n    departments {\n      ...SrcEntryDeptOptFragment\n    }\n  }\n  ","\n"]);return Pn=function(){return e},e}function $n(){var e=Object(b.a)(["\n  fragment SrcEntryDeptOptFragment on Department {\n    __typename\n    id\n    name\n    parent {\n      ... on Business {\n        __typename\n        id\n      }\n      ... on Department {\n        __typename\n        id\n      }\n    }\n  }\n"]);return $n=function(){return e},e}function Un(){var e=Object(b.a)(["\n  fragment SrcEntryPersonOptFragment on Person {\n    __typename\n    id\n    personName: name {\n      first\n      last\n    }\n  }\n"]);return Un=function(){return e},e}function Nn(){var e=Object(b.a)(["\n  fragment CatEntryOptFragment on JournalEntryCategory {\n    __typename\n    id\n    name\n    type\n    parent {\n      __typename\n      id\n    }\n  }\n"]);return Nn=function(){return e},e}function Jn(){var e=Object(b.a)(["\n  fragment DeptEntryOptFragment on Department {\n    __typename\n    id\n    name\n    parent {\n      __typename\n      ... on Business {\n        id\n      }\n      ... on Department {\n        id\n      }\n    }\n  }\n"]);return Jn=function(){return e},e}var Bn=y()(Jn()),Ln=y()(Nn()),Vn=y()(Un()),Wn=y()($n()),zn=y()(Pn(),Wn),qn=y()(Tn()),Gn=t(5835);function Kn(){var e=Object(b.a)(["\n  query PayMethodEntryOpts($where: PaymentMethodWhereInput!) {\n    paymentMethods(where: $where) {\n      ...PayMethodEntryOptFragment\n    }\n  }\n  ","\n"]);return Kn=function(){return e},e}var Xn=y()(Kn(),qn),Qn=function(e){var n,t,a=null!==(n=null===e||void 0===e?void 0:e.value)&&void 0!==n?n:[],r=a.length,l=a[r-1],o=a[r-2];if(void 0===l)return"Method Required";if("string"===typeof l){if((null===o||void 0===o?void 0:o.id)===ke&&!(null!==(t=l.match(/[0-9]/g))&&void 0!==t?t:[]).join(""))return"Check # Required"}else if(l.id===ke)return"Check # Required"},Hn=function(e){return"string"===typeof e?e:e.name},Yn=function(e,n){var t=e.length-1;return e.map((function(a,l){var o,i,u=t===l,c=n({index:l}),d=c.key,s=Object(gn.a)(c,["key"]),m=e[l-1],p="string"===typeof a;switch(null===m||void 0===m?void 0:m.id){case ke:o="CK-"+(p?a:a.name);break;default:o=Hn(a)}if(u){if(!p)switch(a.id){case ke:i=r.a.createElement("span",null,"CK-")}}else i=r.a.createElement(De.a,{fontSize:"small"});return r.a.createElement(ae.a,{key:d,display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"flex-start"},r.a.createElement(Fn.a,Object.assign({color:u?"primary":"default",variant:u?"default":"outlined",label:o,size:"medium"},s,{disabled:!u}))," ",i)}))},Zn=function(e){var n,t,l,o,i,u=e.disabled,c=void 0!==u&&u,d=Object(gn.a)(e,["disabled"]),s=Object(a.useState)(!1),m=Object(B.a)(s,2),p=m[0],f=m[1],b=Object(We.b)({name:"paymentMethod",validate:Qn}),v=Object(B.a)(b,3),y=v[0],E=v[1],O=v[2],j=y.onBlur,g=null!==(n=null===(t=y.value)||void 0===t?void 0:t.value)&&void 0!==n?n:[],h=null!==(l=null===(o=y.value)||void 0===o?void 0:o.inputValue)&&void 0!==l?l:"",R=E.error,C=E.touched,M=O.setValue,_=null!==(i=g[g.length-1])&&void 0!==i?i:null,I=Object(a.useMemo)((function(){return null===_?{where:{hasParent:!1}}:{where:{parent:{eq:_.id}}}}),[_]),k=vn(),A=Object(B.a)(k,2),S=A[0],w=A[1],x=Object(a.useCallback)((function(e){w({msg:e.message,type:rn.FATAL_ERROR})}),[w]),D=Object(G.c)(Xn,{skip:"string"===typeof _,variables:I,onError:x}),F=D.loading,T=D.error,P=D.data,$=Object(a.useMemo)((function(){return(null===P||void 0===P?void 0:P.paymentMethods)&&"string"!==typeof _&&(null===_||void 0===_?void 0:_.id)!==ke?P.paymentMethods:[]}),[P,_]),U=$.length>0,N=Object(a.useMemo)((function(){var e;return(null===(e=_)||void 0===e?void 0:e.id)===ke}),[_]),J=Object(a.useMemo)((function(){return!U&&!N}),[U,N]),L=Object(a.useMemo)((function(){var e;return"string"===typeof _||(null===(e=_)||void 0===e?void 0:e.id)===ke?"Check #":"Payment Method"}),[_]),V=Object(a.useMemo)((function(){var e;return(null===(e=_)||void 0===e?void 0:e.id)===ke?{type:"number"}:{}}),[_]),z=Object(a.useMemo)((function(){var e;return(null===(e=_)||void 0===e?void 0:e.id)===ke?{min:"0",step:"1"}:{}}),[_]),q=Object(a.useCallback)((function(e){var n,t;e.InputProps=Object(W.a)({},null!==(n=e.InputProps)&&void 0!==n?n:{},{},V),e.inputProps=Object(W.a)({},null!==(t=e.inputProps)&&void 0!==t?t:{},{},z);var a=T?T.message:C?R:void 0;return r.a.createElement(hn.a,Object.assign({},d,e,{variant:d.variant||"filled",error:C&&!!R||!!T,helperText:a,name:"paymentMethod",label:L}))}),[d,C,T,R,L,V,z]),K=Object(a.useCallback)((function(e){return f(!0)}),[f]),X=Object(a.useCallback)((function(e){f(!1),e.persist(),setTimeout((function(){j(e)}),0)}),[f,j]),Q=Object(a.useCallback)((function(e,n){M({inputValue:h,value:n})}),[M,h]),H=Object(a.useCallback)((function(e,n,t){n=(n||"").trimStart(),J||M({inputValue:n,value:g})}),[M,g,J]),Y=Object(a.useMemo)((function(){return{value:g,disabled:!!T||F||(null===S||void 0===S?void 0:S.type)===rn.FATAL_ERROR||c,multiple:!0,options:$,renderInput:q,renderTags:Yn,freeSolo:N,getOptionLabel:Hn,onChange:Q,onInputChange:H,inputValue:J?"":h,onFocus:K,onBlur:X,open:p&&U&&(null===S||void 0===S?void 0:S.type)!==rn.FATAL_ERROR,loading:F,autoSelect:!0,name:"paymentMethod"}}),[$,g,q,N,Q,H,h,J,K,X,p,U,F,T,c,S]);return r.a.createElement(Gn.a,Y)},et=t(355),nt=t(183),tt=function(e){var n=Object(ze.a)(),t=e.opacity,a=void 0===t?.62:t,l=Object(gn.a)(e,["opacity"]);return r.a.createElement(ae.a,Object.assign({},l,{overflow:"auto",position:"absolute",display:"flex",alignItems:"center",justifyContent:"center",width:"100%",top:"0px",bottom:"0px",bgcolor:Object(nt.fade)(n.palette.background.paper,a)}))},at=function(e){return r.a.createElement(tt,Object.assign({},e,{children:r.a.createElement(et.a,null)}))};function rt(){var e=Object(b.a)(["\n  fragment JournalEntry_2Fragment on JournalEntry {\n    __typename\n    id\n    date\n    type\n    total {\n      n\n      d\n      s\n    }\n    refunds {\n      id\n      __typename\n      deleted\n      total {\n        n\n        d\n        s\n      }\n    }\n  }\n"]);return rt=function(){return e},e}var lt=y()(rt());function ot(){var e=Object(b.a)(["\n  query GetEntryRefundInfo_1($id: ID!) {\n    journalEntry(id: $id) {\n      ...JournalEntry_2Fragment\n    }\n  }\n  ","\n"]);return ot=function(){return e},e}var it=y()(ot(),lt),ut=Symbol(),ct=function(e){var n,t,l,o,i=e.entryId,u=e.open,c=e.onClose,d=e.onExited,s=e.handleSubmit,m=Object(We.c)(),p=m.resetForm,f=m.isSubmitting,b=m.isValid,v=vn(),y=Object(B.a)(v,2),E=y[0],O=y[1],j=Object(a.useCallback)((function(e){return O({msg:e.message,type:rn.FATAL_ERROR})}),[O]),g=Object(G.c)(it,{skip:!i,variables:{id:i},onError:j}),R=g.loading,C=g.error,M=g.data,_=null===M||void 0===M||null===(n=M.journalEntry)||void 0===n?void 0:n.total,I=(null===M||void 0===M||null===(t=M.journalEntry)||void 0===t?void 0:t.refunds)||[],k=Object(a.useMemo)((function(){if(_){var e=I.reduce((function(e,n){var t=n.deleted,a=n.total;return t?e:e.add(_n(a))}),new tn.a(0));return _n(_).sub(e)}return new tn.a(Number.MAX_SAFE_INTEGER)}),[_,I]),A=null===M||void 0===M||null===(l=M.journalEntry)||void 0===l?void 0:l.date,S=Object(a.useMemo)((function(){return A?new Date(A):void 0}),[A]),w=Object(a.useCallback)((function(){d(),p(),O(null)}),[p,d,O]),x=Object(a.useMemo)((function(){return!E||E.type!==rn.FATAL_ERROR&&E.type!==rn.ERROR?[null,null]:[E.msg,E.type===rn.FATAL_ERROR]}),[E]),D=Object(B.a)(x,2),F=D[0],T=D[1],P=null===M||void 0===M||null===(o=M.journalEntry)||void 0===o?void 0:o.type,$=Object(a.useMemo)((function(){var e=R||C||(null!==P&&void 0!==P?P:ut)===ut?"Refund":"".concat(P===h.Credit?"Give":"Add"," Refund");return T?"Fatal Error":R?"Loading ".concat(e,"..."):f?"Submitting ".concat(e):e}),[R,C,P,T,f]),U=Object(ze.a)();return r.a.createElement(qe.a,{open:u,onClose:c,onExited:w,disableBackdropClick:f,disableEscapeKeyDown:f,fullWidth:!0,maxWidth:"lg",PaperProps:{component:"form",onSubmit:s}},r.a.createElement(Ge.a,{style:F?{color:U.palette.error.main}:void 0},$),r.a.createElement(ae.a,{position:"relative"},(R||f)&&!F&&r.a.createElement(at,{zIndex:"modal"}),!!F&&T&&r.a.createElement(tt,{opacity:.78,zIndex:"modal",padding:2},r.a.createElement(Ke.a,{color:"error"},F)),r.a.createElement(Xe.a,{dividers:!0},!!F&&!T&&r.a.createElement(Ke.a,{color:"error"},F),r.a.createElement(Qe.a,{container:!0,spacing:2},r.a.createElement(Qe.a,{item:!0,lg:4,sm:6,xs:12},r.a.createElement(jn,{minDate:S,disabled:R||f,fullWidth:!0})),r.a.createElement(Qe.a,{item:!0,lg:4,sm:6,xs:12},r.a.createElement(Rn,{disabled:R||f,fullWidth:!0})),r.a.createElement(Qe.a,{item:!0,lg:4,sm:6,xs:12},r.a.createElement(Zn,{disabled:R||f,fullWidth:!0})),r.a.createElement(Qe.a,{item:!0,lg:4,sm:6,xs:12},r.a.createElement(An,{disabled:R||f,fullWidth:!0,maxTotal:k})),r.a.createElement(Qe.a,{item:!0,container:!0,justify:"center",alignItems:"flex-start",lg:4,md:6,sm:12},r.a.createElement(Dn,{disabled:R||f,label:!0}))))),r.a.createElement(He.a,null,!T&&r.a.createElement(Ye.a,{disabled:R||f||!b,type:"submit",startIcon:r.a.createElement(Ze.a,null),color:"primary",variant:"contained"},"Add"),r.a.createElement(Ye.a,{disabled:R||f,color:T?"primary":"default",startIcon:!T&&r.a.createElement(en.a,null),onClick:c},T?"Ok":"Cancel")))},dt=function(e){var n=e.entryId,t=e.open,l=e.onClose,o=e.onExited,i=Object(a.useMemo)((function(){return{}}),[]),u=Object(G.a)(),c=Object(a.useCallback)(function(){var e=Object(N.a)(V.a.mark((function e(t,a){var r;return V.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a.setStatus(null),e.next=4,on(u,n||"",t,a);case 4:l(),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),a.setStatus({msg:null!==(r=e.t0.message)&&void 0!==r?r:"".concat(e.t0),type:rn.ERROR});case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(n,t){return e.apply(this,arguments)}}(),[u,n,l]),d=Object(a.useCallback)((function(e){return r.a.createElement(ct,{entryId:n,open:t,onClose:l,onExited:o,handleSubmit:e.handleSubmit})}),[n,t,l,o]);return r.a.createElement(We.a,{initialValues:i,initialStatus:null,enableReinitialize:!0,onSubmit:c,children:d})},st=t(401);function mt(){var e=Object(b.a)(["\n  mutation UpdateRefund(\n    $id: ID!\n    $fields: JournalEntryUpdateRefundFields!\n    $paymentMethodAdd: PaymentMethodAddFields\n    $paymentMethodUpdate: JournalEntryUpdatePaymentMethod\n  ) {\n    journalEntryUpdateRefund(\n      id: $id\n      fields: $fields\n      paymentMethodAdd: $paymentMethodAdd\n      paymentMethodUpdate: $paymentMethodUpdate\n    ) {\n      id\n      __typename\n      refunds {\n        ...JournalEntryRefund_1Fragment\n      }\n    }\n  }\n  ","\n"]);return mt=function(){return e},e}var pt=y()(mt(),Ce),ft=function(){var e=Object(N.a)(V.a.mark((function e(n,t,a,r){var l,o,i,u,c,d,s,m,p,f,b;return V.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=Object(st.a)(t.date.inputValue,r.date.inputValue)?null:r.date.value,u=r.description!==t.description?null!==(l=null===(o=r.description)||void 0===o?void 0:o.trim())&&void 0!==l?l:"":null,c=0===_n(r.total.value).compare(_n(t.total.value))?null:r.total.value,d=r.reconciled===t.reconciled?null:r.reconciled,s=function(){var e=t.paymentMethod.value[t.paymentMethod.value.length-1],n=r.paymentMethod.value.slice(-2).reverse(),a=Object(B.a)(n,2),l=a[0],o=a[1];return"string"===typeof l?e.parent&&e.parent.id===ke?{paymentMethod:null,paymentMethodAdd:null,paymentMethodUpdate:{id:e.id,fields:{active:null,refId:l,name:l}}}:{paymentMethod:null,paymentMethodAdd:{parent:o.id,refId:l,name:l,active:!1},paymentMethodUpdate:null}:l.id!==e.id?{paymentMethod:l.id,paymentMethodAdd:null,paymentMethodUpdate:null}:{paymentMethod:null,paymentMethodAdd:null,paymentMethodUpdate:null}}(),m=s.paymentMethod,p=s.paymentMethodAdd,f=s.paymentMethodUpdate,b={id:a,fields:{date:i,description:u,total:c,reconciled:d,paymentMethod:m},paymentMethodAdd:p,paymentMethodUpdate:f},e.next=8,n.mutate({mutation:pt,variables:b});case 8:case"end":return e.stop()}}),e)})));return function(n,t,a,r){return e.apply(this,arguments)}}();function bt(){var e=Object(b.a)(["\n  query UpdateRefundIniState($entryId: ID!, $refundId: ID!) {\n    journalEntry(id: $entryId) {\n      ...JournalEntry_2Fragment\n    }\n    journalEntryRefund(id: $refundId) {\n      __typename\n      id\n      date\n      description\n      paymentMethod {\n        ...PayMethodEntryOptFragment\n        ancestors {\n          ...PayMethodEntryOptFragment\n        }\n      }\n      total {\n        n\n        d\n        s\n      }\n      reconciled\n    }\n  }\n  ","\n  ","\n"]);return bt=function(){return e},e}var vt=y()(bt(),lt,qn),yt=function(e){var n=e.refundId,t=e.open,l=e.onClose,o=e.onExited,i=e.journalEntry,u=e.loading,c=e.handleSubmit,d=Object(We.c)(),s=d.resetForm,m=d.isSubmitting,p=d.isValid,f=vn(),b=Object(B.a)(f,2),v=b[0],y=b[1],E=null===i||void 0===i?void 0:i.total,O=(null===i||void 0===i?void 0:i.refunds)||[],j=Object(a.useMemo)((function(){if(E){var e=O.reduce((function(e,t){var a=t.id,r=t.deleted,l=t.total;return r||a===n?e:e.add(_n(l))}),new tn.a(0));return _n(E).sub(e)}return new tn.a(Number.MAX_SAFE_INTEGER)}),[E,O,n]),g=null===i||void 0===i?void 0:i.date,h=Object(a.useMemo)((function(){return g?new Date(g):void 0}),[g]),R=Object(a.useCallback)((function(){o(),s(),y(null)}),[s,o,y]),C=Object(a.useMemo)((function(){return!v||v.type!==rn.FATAL_ERROR&&v.type!==rn.ERROR?[null,null]:[v.msg,v.type===rn.FATAL_ERROR]}),[v]),M=Object(B.a)(C,2),_=M[0],I=M[1],k=Object(a.useMemo)((function(){var e="Refund Update";return I?"Fatal Error":u?"Loading ".concat(e,"..."):m?"Submitting ".concat(e):e}),[u,I,m]),A=Object(ze.a)();return r.a.createElement(qe.a,{open:t,onClose:l,onExited:R,disableBackdropClick:m,disableEscapeKeyDown:m,fullWidth:!0,maxWidth:"lg",PaperProps:{component:"form",onSubmit:c}},r.a.createElement(Ge.a,{style:_?{color:A.palette.error.main}:void 0},k),r.a.createElement(ae.a,{position:"relative"},(u||m)&&!_&&r.a.createElement(at,{zIndex:"modal"}),!!_&&I&&r.a.createElement(tt,{opacity:.78,zIndex:"modal",padding:2},r.a.createElement(Ke.a,{color:"error"},_)),r.a.createElement(Xe.a,{dividers:!0},!!_&&!I&&r.a.createElement(Ke.a,{color:"error"},_),r.a.createElement(Qe.a,{container:!0,spacing:2},r.a.createElement(Qe.a,{item:!0,lg:4,sm:6,xs:12},r.a.createElement(jn,{minDate:h,disabled:u||m||!!I,fullWidth:!0})),r.a.createElement(Qe.a,{item:!0,lg:4,sm:6,xs:12},r.a.createElement(Rn,{disabled:u||m||!!I,fullWidth:!0})),r.a.createElement(Qe.a,{item:!0,lg:4,sm:6,xs:12},r.a.createElement(Zn,{disabled:u||m||!!I,fullWidth:!0})),r.a.createElement(Qe.a,{item:!0,lg:4,sm:6,xs:12},r.a.createElement(An,{disabled:u||m||!!I,fullWidth:!0,maxTotal:j})),r.a.createElement(Qe.a,{item:!0,container:!0,justify:"center",alignItems:"flex-start",lg:4,md:6,sm:12},r.a.createElement(Dn,{disabled:u||m||!!I,label:!0}))))),r.a.createElement(He.a,null,!I&&r.a.createElement(Ye.a,{disabled:u||m||!p,type:"submit",startIcon:r.a.createElement(Ze.a,null),color:"primary",variant:"contained"},"Update"),r.a.createElement(Ye.a,{disabled:u||m||!!I,color:I?"primary":"default",startIcon:!I&&r.a.createElement(en.a,null),onClick:l},I?"Ok":"Cancel")))},Et=function(e){var n=e.entryId,t=e.refundId,l=e.open,o=e.onClose,i=e.onExited,u=Object(G.c)(vt,{skip:!n,variables:{entryId:n,refundId:t}}),c=u.loading,d=u.error,s=u.data,m=Object(a.useMemo)((function(){return d?{msg:d.message,type:rn.FATAL_ERROR}:null}),[d]),p=null===s||void 0===s?void 0:s.journalEntryRefund,f=Object(a.useMemo)((function(){var e;return p?{date:{inputValue:new Date(p.date),value:p.date},paymentMethod:function(){var e=p.paymentMethod,n=e.ancestors,t=Object(gn.a)(e,["ancestors"]),a=Object(J.a)(n).sort((function(e,n){var t,a;return e.id===(null===(t=n.parent)||void 0===t?void 0:t.id)?-1:n.id===(null===(a=e.parent)||void 0===a?void 0:a.id)?1:0}));return a.push(t),{inputValue:"",value:a}}(),total:{inputValue:_n(p.total).round(2).toString(),value:p.total},reconciled:p.reconciled,description:null!==(e=p.description)&&void 0!==e?e:null}:{}}),[p]),b=Object(G.a)(),v=Object(a.useCallback)(function(){var e=Object(N.a)(V.a.mark((function e(n,a){var r;return V.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f){e.next=5;break}return a.setStatus({msg:'Failed to load initial values for refund "'.concat(t,'".'),type:rn.FATAL_ERROR}),e.abrupt("return");case 5:if(t){e.next=8;break}return a.setStatus({msg:"No refund ID.",type:rn.FATAL_ERROR}),e.abrupt("return");case 8:return e.prev=8,a.setStatus(null),e.next=12,ft(b,f,t,n,a);case 12:o(),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(8),a.setStatus({msg:null!==(r=null===e.t0||void 0===e.t0?void 0:e.t0.message)&&void 0!==r?r:"".concat(e.t0),type:rn.FATAL_ERROR});case 18:case"end":return e.stop()}}),e,null,[[8,15]])})));return function(n,t){return e.apply(this,arguments)}}(),[b,f,o,t]),y=Object(a.useCallback)((function(e){var a;return r.a.createElement(yt,{entryId:n,refundId:t,open:l,onClose:o,onExited:i,journalEntry:null!==(a=null===s||void 0===s?void 0:s.journalEntry)&&void 0!==a?a:null,loading:c,handleSubmit:e.handleSubmit})}),[s,n,c,o,i,l,t]);return r.a.createElement(We.a,{initialValues:null!==f&&void 0!==f?f:{},initialStatus:m,enableReinitialize:!0,onSubmit:v,children:y})},Ot=t(5829),jt=t(168);function gt(){var e=Object(b.a)(["\n  mutation AddEntry(\n    $fields: JournalEntryAddFields!\n    $paymentMethodAdd: PaymentMethodAddFields\n    $personAdd: PersonAddFields\n    $businessAdd: BusinessAddFields\n  ) {\n    journalEntryAdd(\n      fields: $fields\n      paymentMethodAdd: $paymentMethodAdd\n      personAdd: $personAdd\n      businessAdd: $businessAdd\n    ) {\n      ...JournalEntry_1Fragment\n    }\n  }\n  ","\n"]);return gt=function(){return e},e}var ht=y()(gt(),_e),Rt=function(){var e=Object(N.a)(V.a.mark((function e(n,t){var a,r,l,o,i,u,c,d,s,m;return V.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=function(){var e=t.paymentMethod.value[t.paymentMethod.value.length-1];return"string"===typeof e?{paymentMethod:"",paymentMethodAdd:{parent:t.paymentMethod.value[t.paymentMethod.value.length-2].id,refId:e,name:e,active:!1}}:{paymentMethod:e.id,paymentMethodAdd:null}}(),o=l.paymentMethod,i=l.paymentMethodAdd,u=function(){var e=t.source.value[0],n=t.source.value[t.source.value.length-1];if("string"===typeof n){if(e===g.Person){var a=Object(jt.parseName)(n);return{source:{sourceType:g.Person,id:""},businessAdd:null,personAdd:{name:{first:a.firstName,last:a.lastName}}}}return{source:{sourceType:g.Business,id:""},businessAdd:{name:n},personAdd:null}}return{source:{sourceType:function(){switch(n.__typename){case"Business":return g.Business;case"Department":return g.Department;case"Person":return g.Person}}(),id:n.id},personAdd:null,businessAdd:null}}(),c=u.source,d=u.personAdd,s=u.businessAdd,m={fields:{date:t.date.value,department:t.department.id,type:t.type,category:t.category.value[t.category.value.length-1].id,description:(null===(a=t.description)||void 0===a?void 0:a.trim())||null,total:t.total.value,reconciled:null!==(r=t.reconciled)&&void 0!==r?r:null,paymentMethod:o,source:c},paymentMethodAdd:i,personAdd:d,businessAdd:s},e.next=5,n.mutate({mutation:ht,variables:m});case 5:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}();function Ct(){var e=Object(b.a)(["\n  query CatEntryOpts($where: JournalEntryCategoryWhereInput!) {\n    catOpts: journalEntryCategories(where: $where) {\n      ...CatEntryOptFragment\n    }\n  }\n  ","\n"]);return Ct=function(){return e},e}var Mt=y()(Ct(),Ln),_t=function(e){return e.name},It=function(e,n){var t=e.length-1;return e.map((function(e,a){var l=t===a,o=n({index:a}),i=o.key,u=Object(gn.a)(o,["key"]);return r.a.createElement(ae.a,{key:i,display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"flex-start"},r.a.createElement(Fn.a,Object.assign({color:l?"primary":"default",variant:l?"default":"outlined",label:e.name,size:"medium"},u,{disabled:!l}))," ",!l&&r.a.createElement(De.a,{fontSize:"small"}))}))},kt=Symbol(),At=function(e){var n,t,l,o,i,u,c=Object(We.c)(),d=e.disabled,s=void 0!==d&&d,m=e.required,p=e.entryType,f=Object(gn.a)(e,["entryType"]),b=(null===(n=c.values)||void 0===n||null===(t=n.category)||void 0===t?void 0:t.value)||[],v=(null===(l=c.values)||void 0===l||null===(o=l.category)||void 0===o?void 0:o.inputValue.trimLeft())||"",y=null!==(i=null!==p&&void 0!==p?p:null===(u=c.values)||void 0===u?void 0:u.type)&&void 0!==i?i:null,E=b[b.length-1],O=Object(a.useMemo)((function(){return(null===E||void 0===E?void 0:E.id)?{where:{parent:{eq:E.id},type:{eq:y}}}:{where:{hasParent:!1,type:{eq:y}}}}),[E,y]),j=vn(),g=Object(B.a)(j,2),h=g[0],R=g[1],C=Object(a.useCallback)((function(e){R({msg:e.message,type:rn.FATAL_ERROR})}),[R]),M=Object(G.c)(Mt,{skip:(null!==y&&void 0!==y?y:kt)===kt,variables:O,onCompleted:function(){return setTimeout((function(){return c.validateField("category")}),0)},onError:C}),_=M.loading,I=M.error,k=M.data,A=null===k||void 0===k?void 0:k.catOpts,S=Object(a.useMemo)((function(){return A||[]}),[A]),w=Object(a.useCallback)((function(e){var n=(null===e||void 0===e?void 0:e.value)||[];return n[n.length-1]||null?S.length>0?"Sub-category Required":void 0:m?"Category Required":void 0}),[S,m]),x=Object(We.b)({name:"category",validate:w}),D=Object(B.a)(x,3),F=D[0],T=D[1],P=D[2],$=F.onBlur,U=T.error,N=T.touched,J=P.setValue;Object(a.useEffect)((function(){E&&y!==E.type&&J({inputValue:"",value:[]})}),[y,E,J]);var L=Object(a.useMemo)((function(){return U&&N?U:(null!==y&&void 0!==y?y:kt)===kt?"Category requires entry type.":I?I.message:""}),[y,U,N,I]),V=Object(a.useMemo)((function(){return _||(null===h||void 0===h?void 0:h.type)===rn.FATAL_ERROR||(null!==y&&void 0!==y?y:kt)===kt||s||b.length>0&&0===S.length}),[s,y,h,_,S.length,b.length]),z=Object(a.useCallback)((function(e){return r.a.createElement(hn.a,Object.assign({},f,{variant:f.variant||"filled"},e,{error:N&&!!U||!!I,disabled:V,helperText:L,name:"category",label:"Category"}))}),[f,N,U,I,V,L]),q=Object(a.useState)(!1),K=Object(B.a)(q,2),X=K[0],Q=K[1],H=Object(a.useCallback)((function(e){return Q(!0)}),[Q]),Y=Object(a.useCallback)((function(e){Q(!1),e.persist(),setTimeout((function(){$(e)}),0)}),[Q,$]),Z=Object(a.useCallback)((function(e,n){J({inputValue:v,value:n})}),[J,v]),ee=Object(a.useCallback)((function(e,n,t){n=(n||"").trimStart(),J({inputValue:n,value:b})}),[J,b]),ne=Object(a.useMemo)((function(){return Object(W.a)({},F,{open:X&&S.length>0,onFocus:H,onBlur:Y,options:S,renderTags:It,forcePopupIcon:!1,disabled:V,value:b,renderInput:z,loading:_,autoSelect:!0,multiple:!0,getOptionLabel:_t,onInputChange:ee,inputValue:v,onChange:Z,name:"category"})}),[F,X,S,H,Y,_,V,b,z,ee,v,Z]);return r.a.createElement(Gn.a,ne)};function St(){var e=Object(b.a)(["\n  query DeptEntryOpts($fromParent: ID) {\n    deptOpts: departments(fromParent: $fromParent) {\n      ...DeptEntryOptFragment\n    }\n  }\n  ","\n"]);return St=function(){return e},e}var wt=y()(St(),Bn),xt=function(e){return e.name},Dt=function(e,n){var t=e.length-1;return e.map((function(e,a){var l=t===a,o=n({index:a}),i=o.key,u=Object(gn.a)(o,["key"]);return r.a.createElement(ae.a,{key:i,display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"flex-start"},r.a.createElement(Fn.a,Object.assign({color:l?"primary":"default",variant:l?"default":"outlined",label:e.name,size:"medium"},u,{disabled:!l}))," ",!l&&r.a.createElement(De.a,{fontSize:"small"}))}))},Ft=function(e){var n=e.disabled,t=void 0!==n&&n,l=e.required,o=vn(),i=Object(B.a)(o,2),u=i[0],c=i[1],d=Object(a.useCallback)((function(e){c({msg:e.message,type:rn.FATAL_ERROR})}),[c]),s=Object(G.c)(wt,{onError:d,variables:{fromParent:"5dc4b09bcf96e166daaa0090"}}),m=s.loading,p=s.error,f=s.data,b=(null===f||void 0===f?void 0:f.deptOpts)||[],v=Object(a.useState)(!1),y=Object(B.a)(v,2),E=y[0],O=y[1],j=Object(a.useState)(""),g=Object(B.a)(j,2),h=g[0],R=g[1],C=Object(a.useCallback)((function(e){return e?b.some((function(n){var t=n.parent;return"Department"===t.__typename&&t.id===e.id}))?"Sub-department Required":void 0:l?"Department Required":void 0}),[b,l]),M=Object(We.b)({name:"department",validate:C}),_=Object(B.a)(M,3),I=_[0],k=_[1],A=_[2],S=I.value,w=I.onBlur,x=k.error,D=k.touched,F=A.setValue,T=Object(a.useMemo)((function(){return new Map(b.reduce((function(e,n){return e.push([n.id,n]),e}),[]))}),[b]),P=Object(a.useMemo)((function(){if(!S)return[];for(var e=[S],n=S.parent,t=n.__typename,a=n.id;"Business"!==t&&T.has(a);){var r=T.get(a);e.unshift(r);var l=r.parent;t=l.__typename,a=l.id}return e}),[S,T]),$=Object(a.useMemo)((function(){var e,n=null===(e=P[P.length-1])||void 0===e?void 0:e.id;return b.filter((function(e){return n?e.parent.id===n:"Business"===e.parent.__typename}))}),[b,P]),U=Object(a.useMemo)((function(){return P.length>0&&0===$.length}),[P,$]),N=Object(a.useMemo)((function(){return x&&D?x:p?p.message:""}),[x,D,p]),J=Object(a.useMemo)((function(){return m||U||(null===u||void 0===u?void 0:u.type)===rn.FATAL_ERROR||t}),[U,t,u,m]),L=Object(a.useCallback)((function(n){return r.a.createElement(hn.a,Object.assign({},e,{variant:e.variant||"filled"},n,{error:D&&!!x,helperText:N,name:"department",label:"Department",disabled:J}))}),[e,D,x,N,J]),V=Object(a.useCallback)((function(e){return O(!0)}),[O]),z=Object(a.useCallback)((function(e){O(!1),w(e)}),[O,w]),q=Object(a.useCallback)((function(e,n){if(n)if(Array.isArray(n)){var t=n.length;F(0===t?null:n[t-1])}else F(n);else F(null)}),[F]),K=Object(a.useCallback)((function(e,n,t){R((n||"").trimStart())}),[R]),X=Object(a.useMemo)((function(){return Object(W.a)({},I,{open:E&&$.length>0,onFocus:V,onBlur:z,options:$,renderTags:Dt,forcePopupIcon:!1,disabled:J,value:P,renderInput:L,loading:m,autoSelect:!0,multiple:!0,getOptionLabel:xt,onChange:q,onInputChange:K,inputValue:U?"":h,name:"department"})}),[I,E,$,V,z,U,J,P,L,m,q,K,h]);return p?r.a.createElement("pre",null,JSON.stringify(p,null,2)):r.a.createElement(Gn.a,X)},Tt=t(299);function Pt(){var e=Object(b.a)(["\n  query SrcEntryOpts($name: String!, $isBiz: Boolean!) {\n    businesses(searchByName: $name) @include(if: $isBiz) {\n      ...SrcEntryBizOptFragment\n    }\n    people(searchByName: { first: $name, last: $name }) @skip(if: $isBiz) {\n      ...SrcEntryPersonOptFragment\n    }\n  }\n  ","\n  ","\n  ","\n"]);return Pt=function(){return e},e}var $t=y()(Pt(),Vn,zn,Wn),Ut=function(e){switch(e){case g.Business:case g.Department:case g.Person:break;default:return"string"===typeof e}return!1},Nt=function(e){switch(e){case g.Business:return"Vendor";case g.Department:return"Department";case g.Person:return"Person";default:if("string"===typeof e)return e}return"Person"===e.__typename?"".concat(e.personName.first," ").concat(e.personName.last):e.name},Jt=function(e,n){var t=e.length-1;return e.map((function(e,a){var l=t===a,o=n({index:a}),i=o.key,u=Object(gn.a)(o,["key"]);return Ut(e)?e:r.a.createElement(ae.a,{key:i,display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"flex-start"},r.a.createElement(Fn.a,Object.assign({color:l?"primary":"default",variant:l?"default":"outlined",label:Nt(e),size:"medium"},u,{disabled:!l}))," ",!l&&r.a.createElement(De.a,{fontSize:"small"}))}))},Bt=function(e,n){var t=n.inputValue,a=new RegExp("(^|\\s)".concat(t),"i");return e.filter((function(e){return a.test(Nt(e))}))},Lt=function(e){var n,t=(null===e||void 0===e?void 0:e.value)||[],a=null!==(n=t[0])&&void 0!==n?n:null,r=t.length>1?t[t.length-1]:null;if(null===a||null===r||""===r)return"Source Required";if(Ut(r)&&a===g.Person){var l=Object(jt.parseName)(r);if(!l.firstName.trim())return"First Name Required";if(!l.lastName.trim())return"Last Name Required"}},Vt=function(e){var n,t,l,o,i,u=e.disabled,c=void 0!==u&&u,d=Object(a.useState)(!1),s=Object(B.a)(d,2),m=s[0],p=s[1],f=Object(We.b)({name:"source",validate:Lt}),b=Object(B.a)(f,3),v=b[0],y=b[1],E=b[2],O=v.onBlur,j=null!==(n=null===(t=v.value)||void 0===t?void 0:t.value)&&void 0!==n?n:[],h=null!==(l=null===(o=v.value)||void 0===o?void 0:o.inputValue)&&void 0!==l?l:"",R=y.error,C=y.touched,M=E.setValue,_=null!==(i=j[0])&&void 0!==i?i:null,I=j.length>1?j[j.length-1]:null,k=Object(a.useRef)(""),A=vn(),S=Object(B.a)(A,2),w=S[0],x=S[1],D=Object(a.useCallback)((function(e){x({msg:e.message,type:rn.FATAL_ERROR})}),[x]),F=Object(G.c)($t,{skip:!k.current&&!j[1],variables:{name:k.current,isBiz:_!==g.Person},onError:D}),T=F.loading,P=F.error,$=F.data,U=Object(a.useMemo)((function(){var e=new Map,n=!0,t=!1,a=void 0;try{for(var r,l=((null===$||void 0===$?void 0:$.businesses)||[])[Symbol.iterator]();!(n=(r=l.next()).done);n=!0){var o=r.value,i=!0,u=!1,c=void 0;try{for(var d,s=o.departments[Symbol.iterator]();!(i=(d=s.next()).done);i=!0){var m=d.value;e.set(m.id,m)}}catch(p){u=!0,c=p}finally{try{i||null==s.return||s.return()}finally{if(u)throw c}}}}catch(p){t=!0,a=p}finally{try{n||null==l.return||l.return()}finally{if(t)throw a}}return e}),[$]),N=Object(a.useMemo)((function(){if(null===_)return[g.Business,g.Person];if(_===g.Person)return null===I&&(null===$||void 0===$?void 0:$.people)||[];if(!I)return(null===$||void 0===$?void 0:$.businesses)||[];if("string"===typeof I)return[];var e=[],n=!0,t=!1,a=void 0;try{for(var r,l=U.values()[Symbol.iterator]();!(n=(r=l.next()).done);n=!0){var o=r.value;o.parent.__typename===I.__typename&&o.parent.id===I.id&&e.push(o)}}catch(i){t=!0,a=i}finally{try{n||null==l.return||l.return()}finally{if(t)throw a}}return e}),[_,$,U,I]),J=Object(a.useMemo)((function(){return null!==_&&null===I}),[_,I]),L=Object(a.useMemo)((function(){return j.length>0&&0===N.length&&!J}),[j,N,J]),V=Object(a.useMemo)((function(){return null===_?"Source Type":_===g.Person?"Person Name":1===j.length?"Vendor":2===j.length&&N.length>0?"Department":N.length>0?"Sub-Department":"Vendor"}),[j,N,_]),z=Object(a.useMemo)((function(){return c||L||(null===w||void 0===w?void 0:w.type)===rn.FATAL_ERROR}),[L,c,w]),q=Object(a.useCallback)((function(n){var t,a,l;I&&"string"!==typeof I&&"Person"!==I.__typename&&0===N.length&&(n=Object(W.a)({},n,{inputProps:Object(W.a)({},(null===(t=n)||void 0===t?void 0:t.inputProps)||{},{style:Object(W.a)({},(null===(a=n)||void 0===a||null===(l=a.inputProps)||void 0===l?void 0:l.style)||{},{display:"none"})})}));return r.a.createElement(hn.a,Object.assign({},e,{variant:e.variant||"filled"},n,{error:C&&!!R,helperText:C?R:void 0,name:"source",label:V,disabled:z}))}),[I,N.length,e,C,R,V,z]),K=Object(a.useCallback)((function(e){return p(!0)}),[p]),X=Object(a.useCallback)((function(e){p(!1),e.persist(),setTimeout((function(){return O(e)}),0)}),[p,O]),Q=Object(a.useCallback)((function(e,n){var t=n.length-1,a=n[t];if(Ut(a)){var r=[],l=!0,o=!1,i=void 0;try{for(var u,c=a.split(" ")[Symbol.iterator]();!(l=(u=c.next()).done);l=!0){var d=u.value;d&&(Tt.checkName(d)&&(d=Tt(d)),r.push(d))}}catch(m){o=!0,i=m}finally{try{l||null==c.return||c.return()}finally{if(o)throw i}}var s=r.join(" ").trim();n[t]=s.charAt(0).toUpperCase()+s.substring(1)}M({inputValue:h,value:n})}),[M,h]),H=Object(a.useCallback)((function(e,n,t){n=(n||"").trimStart(),L||M({inputValue:n,value:j}),null!==_&&null===I&&n&&(k.current=n[0].toLowerCase())}),[M,_,I,j,L,k]),Y=Object(a.useMemo)((function(){return Object(W.a)({},v,{inputValue:L?"":h,open:m&&N.length>0,onFocus:K,onBlur:X,options:N,renderTags:Jt,forcePopupIcon:!1,freeSolo:J,value:j,renderInput:q,loading:T,autoSelect:!0,multiple:!0,getOptionLabel:Nt,onInputChange:H,onChange:Q,filterOptions:Bt,name:"source",disabled:z})}),[v,L,h,m,N,K,X,J,j,q,T,H,Q,z]);return P?r.a.createElement("pre",null,JSON.stringify(P,null,2)):r.a.createElement(Gn.a,Y)},Wt=t(5837),zt=t(5828),qt=t(360),Gt=t(292),Kt=t(5777),Xt=Symbol(),Qt=function(e){if((null!==e&&void 0!==e?e:Xt)===Xt)return"Type Required"},Ht=function(e){var n=e.disabled,t=void 0!==n&&n,l=vn(),o=Object(B.a)(l,1)[0],i=e.label,u=void 0!==i&&i,c=Object(We.c)().isSubmitting,d=Object(We.b)({name:"type",validate:Qt}),s=Object(B.a)(d,3),m=s[0],p=s[1],f=s[2],b=p.error,v=p.touched,y=f.setValue,E=f.setTouched,O=Object(a.useMemo)((function(){return Object(W.a)({size:"small",exclusive:!0,disabled:c},m,{onChange:function(){var e=Object(N.a)(V.a.mark((function e(n,t){return V.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((null!==t&&void 0!==t?t:Xt)!==Xt){e.next=2;break}return e.abrupt("return");case 2:return y(t),e.next=5,new Promise((function(e){return setTimeout(e,0)}));case 5:E(!0);case 6:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}()})}),[m,c,y,E]),j=c||t||(null===o||void 0===o?void 0:o.type)===rn.FATAL_ERROR,g=Object(a.useMemo)((function(){return r.a.createElement(ae.a,{pl:1,clone:!0},r.a.createElement(Wt.a,Object.assign({},e,O),r.a.createElement(zt.a,{disabled:j,value:h.Credit},r.a.createElement(qt.a,{arrow:!0,placement:"top",title:"Credit"},r.a.createElement(de.b,null))),r.a.createElement(zt.a,{disabled:j,value:h.Debit},r.a.createElement(qt.a,{arrow:!0,placement:"top",title:"Debit"},r.a.createElement(de.a,null)))))}),[e,O,j]);return u?r.a.createElement(Gt.a,null,r.a.createElement(Sn.a,Object.assign({},e,{labelPlacement:"boolean"===typeof u?void 0:u,control:g,label:"Type"})),v&&!!b&&r.a.createElement(Kt.a,{error:!0},b)):r.a.createElement(Gt.a,null,g,!!b&&r.a.createElement(Kt.a,{error:!0},b))};function Yt(){var e=Object(b.a)(["\n  query DeptIniValueForAddEntry($id: ID!) {\n    department(id: $id) {\n      ...DeptEntryOptFragment\n    }\n  }\n  ","\n"]);return Yt=function(){return e},e}var Zt={item:!0,lg:4,sm:6,xs:12},ea=y()(Yt(),Bn),na=function(e){var n=e.open,t=e.onClose,l=e.loading,o=Object(We.c)(),i=o.resetForm,u=o.isSubmitting,c=o.isValid,d=o.submitForm,s=vn(),m=Object(B.a)(s,2),p=m[0],f=m[1],b=Object(a.useMemo)((function(){return!p||p.type!==rn.FATAL_ERROR&&p.type!==rn.ERROR?[null,null]:[p.msg,p.type===rn.FATAL_ERROR]}),[p]),v=Object(B.a)(b,2),y=v[0],E=v[1],O=Object(a.useCallback)((function(){i(),f(null)}),[i,f]),j=Object(a.useMemo)((function(){return E?"Fatal Error":u?"Submitting Add Entry...":l?"Loading Add Entry...":"Add Entry"}),[E,u,l]),g=Object(ze.a)(),h=Object(a.useCallback)(Object(N.a)(V.a.mark((function e(){var n;return V.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,f(null),e.next=4,d();case 4:t(),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),f({msg:null!==(n=e.t0.message)&&void 0!==n?n:"".concat(e.t0),type:rn.ERROR});case 10:case"end":return e.stop()}}),e,null,[[0,7]])}))),[d,t,f]),R=Object(a.useCallback)(Object(N.a)(V.a.mark((function e(){var n;return V.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,f(null),e.next=4,d();case 4:i(),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),f({msg:null!==(n=e.t0.message)&&void 0!==n?n:"".concat(e.t0),type:rn.ERROR});case 10:case"end":return e.stop()}}),e,null,[[0,7]])}))),[d,i,f]),C=Object(a.useCallback)((function(e){return e.preventDefault()}),[]);return r.a.createElement(qe.a,{open:n,onClose:t,onExited:O,disableBackdropClick:u,disableEscapeKeyDown:u,fullWidth:!0,maxWidth:"lg",PaperProps:{component:"form",onSubmit:C}},r.a.createElement(Ge.a,{style:y?{color:g.palette.error.main}:void 0},j),r.a.createElement(ae.a,{position:"relative"},(u||l)&&!y&&r.a.createElement(at,{zIndex:"modal"}),!!y&&E&&r.a.createElement(tt,{opacity:.78,zIndex:"modal",padding:2},r.a.createElement(Ke.a,{color:"error"},y)),r.a.createElement(Xe.a,{dividers:!0},!!y&&!E&&r.a.createElement(Ke.a,{color:"error"},y),r.a.createElement(Qe.a,{container:!0,spacing:2},r.a.createElement(Qe.a,Object.assign({},Zt,{justify:"center",container:!0}),r.a.createElement(Ht,{style:{margin:g.spacing(1)},label:"start",disabled:l||u||!!E})),r.a.createElement(Qe.a,Zt,r.a.createElement(jn,{disabled:l||u||!!E,fullWidth:!0})),r.a.createElement(Qe.a,Zt,r.a.createElement(Vt,{disabled:l||u||!!E,fullWidth:!0})),r.a.createElement(Qe.a,Zt,r.a.createElement(At,{disabled:l||u||!!E,fullWidth:!0,required:!0})),r.a.createElement(Qe.a,Zt,r.a.createElement(Ft,{disabled:l||u||!!E,fullWidth:!0,required:!0})),r.a.createElement(Qe.a,Zt,r.a.createElement(Rn,{disabled:l||u||!!E,fullWidth:!0})),r.a.createElement(Qe.a,Zt,r.a.createElement(Zn,{disabled:l||u||!!E,fullWidth:!0})),r.a.createElement(Qe.a,Zt,r.a.createElement(An,{disabled:l||u||!!E,fullWidth:!0})),r.a.createElement(Qe.a,Object.assign({container:!0,justify:"center",alignItems:"flex-start"},Zt),r.a.createElement(Dn,{disabled:l||u||!!E,label:!0}))))),r.a.createElement(He.a,null,!E&&r.a.createElement(r.a.Fragment,null,r.a.createElement(Ye.a,{onClick:h,disabled:l||u||!c,type:"submit",startIcon:r.a.createElement(Ze.a,null),color:"primary",variant:"contained"},"Add"),r.a.createElement(Ye.a,{onClick:R,disabled:l||u||!c,type:"submit",startIcon:r.a.createElement(Ot.a,null),variant:"outlined"},"Add & New")),r.a.createElement(Ye.a,{disabled:u,color:E?"primary":"default",startIcon:!E&&r.a.createElement(en.a,null),onClick:t},E?"Ok":"Cancel")))},ta=function(e){var n=e.open,t=e.onClose,l=e.deptId,o=Object(G.c)(ea,{skip:!l,variables:{id:l}}),i=o.loading,u=o.error,c=o.data,d=null===c||void 0===c?void 0:c.department,s=Object(a.useMemo)((function(){return d?{department:d}:{}}),[d]),m=Object(a.useMemo)((function(){return u?{msg:u.message,type:rn.FATAL_ERROR}:null}),[u]),p=Object(G.a)(),f=Object(a.useCallback)((function(e,n){return Rt(p,e,n)}),[p]),b=Object(a.useCallback)((function(e){return r.a.createElement(na,{open:n,onClose:t,loading:i})}),[n,t,i]);return r.a.createElement(We.a,{initialValues:s,initialStatus:m,enableReinitialize:!0,onSubmit:f,children:b})};function aa(){var e=Object(b.a)(["\n  mutation UpdateEntry(\n    $id: ID!\n    $fields: JournalEntryUpdateFields!\n    $paymentMethodAdd: PaymentMethodAddFields\n    $paymentMethodUpdate: JournalEntryUpdatePaymentMethod\n    $personAdd: PersonAddFields\n    $businessAdd: BusinessAddFields\n  ) {\n    journalEntryUpdate(\n      id: $id\n      fields: $fields\n      paymentMethodAdd: $paymentMethodAdd\n      paymentMethodUpdate: $paymentMethodUpdate\n      personAdd: $personAdd\n      businessAdd: $businessAdd\n    ) {\n      ...JournalEntry_1Fragment\n    }\n  }\n  ","\n"]);return aa=function(){return e},e}Symbol();var ra=y()(aa(),_e),la=function(){var e=Object(N.a)(V.a.mark((function e(n,t,a,r){var l,o,i,u,c,d,s,m,p,f,b,v,y,E,O,j,h;return V.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=function(){var e,n,a,l,o=null!==(e=null===(n=r.category.value[r.category.value.length-1])||void 0===n?void 0:n.id)&&void 0!==e?e:null;return o===(null!==(a=null===(l=t.category.value[t.category.value.length-1])||void 0===l?void 0:l.id)&&void 0!==a?a:null)?null:o}(),i=Object(st.a)(t.date.inputValue,r.date.inputValue)?null:r.date.value,u=r.department.id===t.department.id?null:r.department.id,c=(null===(l=r.description)||void 0===l?void 0:l.trim())&&r.description!==t.description?r.description.trim():null,d=0===_n(r.total.value).compare(_n(t.total.value))?null:r.total.value,s=r.type===t.type?null:r.type,m=r.reconciled===t.reconciled?null:r.reconciled,p=function(){var e=t.paymentMethod.value[t.paymentMethod.value.length-1],n=r.paymentMethod.value.slice(-2).reverse(),a=Object(B.a)(n,2),l=a[0],o=a[1];return"string"===typeof l?e.parent&&e.parent.id===ke?{paymentMethod:null,paymentMethodAdd:null,paymentMethodUpdate:{id:e.id,fields:{active:null,refId:l,name:l}}}:{paymentMethod:null,paymentMethodAdd:{parent:o.id,refId:l,name:l,active:!1},paymentMethodUpdate:null}:l.id!==e.id?{paymentMethod:l.id,paymentMethodAdd:null,paymentMethodUpdate:null}:{paymentMethod:null,paymentMethodAdd:null,paymentMethodUpdate:null}}(),f=p.paymentMethod,b=p.paymentMethodAdd,v=p.paymentMethodUpdate,y=function(){var e=r.source.value[0],n=r.source.value[r.source.value.length-1],a=t.source.value[0],l=t.source.value[t.source.value.length-1];if("string"===typeof n){if(e===g.Person){var o=Object(jt.parseName)(n);return{source:{sourceType:g.Person,id:""},businessAdd:null,personAdd:{name:{first:o.firstName,last:o.lastName}}}}return{source:{sourceType:g.Business,id:""},businessAdd:{name:n},personAdd:null}}return e===a&&n.id===l.id?{source:null,businessAdd:null,personAdd:null}:{source:{sourceType:function(){switch(n.__typename){case"Business":return g.Business;case"Department":return g.Department;case"Person":return g.Person}}(),id:n.id},personAdd:null,businessAdd:null}}(),E=y.source,O=y.personAdd,j=y.businessAdd,h={id:a,fields:{category:o,date:i,department:u,description:c,total:d,type:s,source:E,reconciled:m,paymentMethod:f},paymentMethodAdd:b,paymentMethodUpdate:v,personAdd:O,businessAdd:j},console.log(h),e.next=13,n.mutate({mutation:ra,variables:h});case 13:case"end":return e.stop()}}),e)})));return function(n,t,a,r){return e.apply(this,arguments)}}();function oa(){var e=Object(b.a)(["\n  query UpdateEntryIniState($id: ID!) {\n    journalEntry(id: $id) {\n      id\n      __typename\n      type\n      date\n      department {\n        ...DeptEntryOptFragment\n      }\n      category {\n        ...CatEntryOptFragment\n        ancestors {\n          ...CatEntryOptFragment\n        }\n      }\n      source {\n        ...SrcEntryPersonOptFragment\n        ...SrcEntryBizOptFragment\n        ...SrcEntryDeptOptFragment\n        ... on Department {\n          ancestors {\n            ...SrcEntryDeptOptFragment\n            ...SrcEntryBizOptFragment\n          }\n        }\n      }\n      paymentMethod {\n        ...PayMethodEntryOptFragment\n        ancestors {\n          ...PayMethodEntryOptFragment\n        }\n      }\n      description\n      total {\n        n\n        d\n        s\n      }\n      refunds {\n        id\n        __typename\n        deleted\n        date\n        total {\n          n\n          d\n          s\n        }\n      }\n      reconciled\n    }\n  }\n  ","\n  ","\n  ","\n  ","\n  ","\n  ","\n"]);return oa=function(){return e},e}var ia=y()(oa(),Bn,Ln,Vn,zn,Wn,qn),ua=new Date(864e13),ca={item:!0,lg:4,sm:6,xs:12},da=function(e){var n=e.open,t=e.onClose,l=e.onExited,o=e.journalEntry,i=e.loading,u=e.handleSubmit,c=Object(We.c)(),d=c.resetForm,s=c.isSubmitting,m=c.isValid,p=vn(),f=Object(B.a)(p,2),b=f[0],v=f[1],y=(null===o||void 0===o?void 0:o.refunds)||[],E=Object(a.useMemo)((function(){return y.reduce((function(e,n){var t=Object(B.a)(e,2),a=t[0],r=t[1],l=(n.id,n.deleted),o=n.total,i=n.date;return[l?a:a.add(_n(o)),l?r:Object(fn.a)([r,new Date(i)])]}),[new tn.a(0),ua])}),[y]),O=Object(B.a)(E,2),j=O[0],g=O[1],h=Object(a.useCallback)((function(){l(),d(),v(null)}),[d,l,v]),R=Object(a.useMemo)((function(){return!b||b.type!==rn.FATAL_ERROR&&b.type!==rn.ERROR?[null,null]:[b.msg,b.type===rn.FATAL_ERROR]}),[b]),C=Object(B.a)(R,2),M=C[0],_=C[1],I=Object(a.useMemo)((function(){var e="Entry Update";return _?"Fatal Error":i?"Loading ".concat(e,"..."):s?"Submitting ".concat(e):e}),[i,_,s]),k=Object(ze.a)();return r.a.createElement(qe.a,{open:n,onClose:t,onExited:h,fullWidth:!0,disableBackdropClick:s,disableEscapeKeyDown:s,maxWidth:"lg",PaperProps:{component:"form",onSubmit:u}},r.a.createElement(Ge.a,{style:M?{color:k.palette.error.main}:void 0},I),r.a.createElement(ae.a,{position:"relative"},(s||i)&&!M&&r.a.createElement(at,{zIndex:"modal"}),!!M&&_&&r.a.createElement(tt,{opacity:.78,zIndex:"modal",padding:2},r.a.createElement(Ke.a,{color:"error"},M)),r.a.createElement(Xe.a,{dividers:!0},!!M&&!_&&r.a.createElement(Ke.a,{color:"error"},M),r.a.createElement(Qe.a,{container:!0,spacing:2},r.a.createElement(Qe.a,Object.assign({},ca,{justify:"center",container:!0}),r.a.createElement(Ht,{style:{margin:k.spacing(1)},label:"start",disabled:s||i||!!_})),r.a.createElement(Qe.a,ca,r.a.createElement(jn,{disabled:s||i||!!_,maxDate:g===ua?void 0:g,fullWidth:!0})),r.a.createElement(Qe.a,ca,r.a.createElement(Vt,{disabled:s||i||!!_,fullWidth:!0})),r.a.createElement(Qe.a,ca,r.a.createElement(At,{disabled:s||i||!!_,fullWidth:!0,required:!0})),r.a.createElement(Qe.a,ca,r.a.createElement(Ft,{disabled:s||i||!!_,fullWidth:!0,required:!0})),r.a.createElement(Qe.a,ca,r.a.createElement(Rn,{disabled:s||i||!!_,fullWidth:!0})),r.a.createElement(Qe.a,ca,r.a.createElement(Zn,{disabled:s||i||!!_,fullWidth:!0})),r.a.createElement(Qe.a,ca,r.a.createElement(An,{disabled:s||i||!!_,minTotal:j,fullWidth:!0})),r.a.createElement(Qe.a,Object.assign({container:!0,justify:"center",alignItems:"flex-start"},ca),r.a.createElement(Dn,{disabled:s||i||!!_,label:!0}))))),r.a.createElement(He.a,null,!_&&r.a.createElement(Ye.a,{disabled:s||!m||i,type:"submit",startIcon:r.a.createElement(Ze.a,null),color:"primary",variant:"contained"},"Update"),r.a.createElement(Ye.a,{disabled:s,color:_?"primary":"default",startIcon:!_&&r.a.createElement(en.a,null),onClick:t},_?"Ok":"Cancel")))},sa=function(e){var n,t=e.entryId,l=e.open,o=e.onClose,i=e.onExited,u=Object(G.c)(ia,{skip:!t,variables:{id:t}}),c=u.loading,d=u.error,s=u.data;d&&(console.log(t,ia),console.error(d));var m=Object(a.useMemo)((function(){return d?{msg:d.message,type:rn.FATAL_ERROR}:null}),[d]),p=null===s||void 0===s?void 0:s.journalEntry,f=Object(a.useMemo)((function(){var e;if(!p)return{};var n={inputValue:new Date(p.date),value:p.date},t=function(){var e=p.category,n=e.ancestors,t=Object(gn.a)(e,["ancestors"]),a=Object(J.a)(n).sort((function(e,n){var t,a;return e.id===(null===(t=n.parent)||void 0===t?void 0:t.id)?-1:n.id===(null===(a=e.parent)||void 0===a?void 0:a.id)?1:0}));return a.push(t),{inputValue:"",value:a}}(),a=function(){var e=p.paymentMethod,n=e.ancestors,t=Object(gn.a)(e,["ancestors"]),a=Object(J.a)(n).sort((function(e,n){var t,a;return e.id===(null===(t=n.parent)||void 0===t?void 0:t.id)?-1:n.id===(null===(a=e.parent)||void 0===a?void 0:a.id)?1:0}));return a.push(t),{inputValue:"",value:a}}(),r={inputValue:_n(p.total).round(2).toString(),value:p.total};return{date:n,category:t,paymentMethod:a,department:p.department,total:r,reconciled:p.reconciled,description:null!==(e=p.description)&&void 0!==e?e:null,type:p.type,source:function(){var e=[],n=null===p||void 0===p?void 0:p.source;switch(null===n||void 0===n?void 0:n.__typename){case"Person":e.push(g.Person,n);break;case"Business":e.push(g.Business,n);break;case"Department":e.push(g.Business);var t=[],a=!0,r=!1,l=void 0;try{for(var o,i=n.ancestors[Symbol.iterator]();!(a=(o=i.next()).done);a=!0){var u=o.value;"Business"===u.__typename?e.push(u):t.push(u.id)}}catch(E){r=!0,l=E}finally{try{a||null==i.return||i.return()}finally{if(r)throw l}}var c=e[1];if(t.length>0){var d=[],s=!0,m=!1,f=void 0;try{for(var b,v=c.departments[Symbol.iterator]();!(s=(b=v.next()).done);s=!0){var y=b.value;if(-1!==t.indexOf(y.id)&&d.push(y)===t.length)break}}catch(E){m=!0,f=E}finally{try{s||null==v.return||v.return()}finally{if(m)throw f}}d.sort((function(e,n){return e.id===n.parent.id||c.id||e.parent.id?-1:n.id===e.parent.id?1:0})),e.push.apply(e,d.concat([n]))}}return{inputValue:"",value:e}}()}}),[p]),b=Object(G.a)(),v=Object(a.useCallback)(function(){var e=Object(N.a)(V.a.mark((function e(n,a){var r;return V.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a.setStatus(null),e.next=4,la(b,f,t,n,a);case 4:o(),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.error(e.t0),a.setStatus({msg:null!==(r=e.t0.message)&&void 0!==r?r:"".concat(e.t0),type:rn.ERROR});case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(n,t){return e.apply(this,arguments)}}(),[b,f,t,o]),y=Object(a.useCallback)((function(e){return r.a.createElement(da,{open:l,onClose:o,onExited:i,loading:c,journalEntry:null!==p&&void 0!==p?p:null,handleSubmit:e.handleSubmit})}),[l,o,i,c,p]);return r.a.createElement(We.a,{initialValues:f,initialStatus:m,journalEntry:null!==(n=null===s||void 0===s?void 0:s.journalEntry)&&void 0!==n?n:null,loading:c,onSubmit:v,enableReinitialize:!0,children:y})};function ma(){var e=Object(b.a)(["\n  mutation DeleteEntry($id: ID!) {\n    journalEntryDelete(id: $id) {\n      ...JournalEntry_1Fragment\n    }\n  }\n  ","\n"]);return ma=function(){return e},e}var pa=y()(ma(),_e),fa=function(e){var n=e.entryId,t=e.onClose,l=Object(G.b)(pa),o=Object(B.a)(l,2),i=o[0],u=o[1],c=u.loading,d=u.error,s=!!d,m=Object(a.useCallback)((function(e){i({variables:{id:n}}).then((function(){return t()}))}),[n,i,t]),p=Object(a.useMemo)((function(){return s?"Error":c?"Deleting Entry...":"Delete Entry"}),[s,c]),f=Object(ze.a)();return r.a.createElement(qe.a,{open:!!n,maxWidth:"sm",fullWidth:!0,disableBackdropClick:c,disableEscapeKeyDown:c,onClose:t},r.a.createElement(Ge.a,{style:s?{color:f.palette.error.main}:void 0},p),r.a.createElement(ae.a,{position:"relative"},c&&r.a.createElement(at,{zIndex:"modal"}),r.a.createElement(Xe.a,null,s&&r.a.createElement(Ke.a,{color:"error"},null===d||void 0===d?void 0:d.message),!s&&r.a.createElement(Ke.a,null,"Are you sure you want to delete this entry?"))),r.a.createElement(He.a,null,!s&&r.a.createElement(Ye.a,{disabled:c,onClick:m,startIcon:r.a.createElement(ee.a,null),color:"primary",variant:"contained"},"Delete"),r.a.createElement(Ye.a,{disabled:c,startIcon:!s&&r.a.createElement(en.a,null),onClick:t},s?"Close":"Cancel")))};function ba(){var e=Object(b.a)(["\n  mutation DeleteRefund($id: ID!) {\n    journalEntryDeleteRefund(id: $id) {\n      ...JournalEntry_1Fragment\n    }\n  }\n  ","\n"]);return ba=function(){return e},e}var va=y()(ba(),_e),ya=function(e){var n=e.refundId,t=e.onClose,l=Object(G.b)(va),o=Object(B.a)(l,2),i=o[0],u=o[1],c=u.loading,d=u.error,s=!!d,m=Object(a.useCallback)((function(e){i({variables:{id:n}}).then((function(){return t()}))}),[n,i,t]),p=Object(a.useMemo)((function(){return s?"Error":c?"Deleting Refund...":"Delete Refund"}),[s,c]),f=Object(ze.a)();return r.a.createElement(qe.a,{open:!!n,maxWidth:"sm",fullWidth:!0,disableBackdropClick:c,disableEscapeKeyDown:c,onClose:t},r.a.createElement(Ge.a,{style:s?{color:f.palette.error.main}:void 0},p),r.a.createElement(ae.a,{position:"relative"},c&&r.a.createElement(at,{zIndex:"modal"}),r.a.createElement(Xe.a,null,s&&r.a.createElement(Ke.a,{color:"error"},null===d||void 0===d?void 0:d.message),!s&&r.a.createElement(Ke.a,null,"Are you sure you want to delete this refund?"))),r.a.createElement(He.a,null,!s&&r.a.createElement(Ye.a,{disabled:c,onClick:m,startIcon:r.a.createElement(ee.a,null),color:"primary",variant:"contained"},"Delete"),r.a.createElement(Ye.a,{disabled:c,startIcon:!s&&r.a.createElement(en.a,null),onClick:t},s?"Close":"Cancel")))},Ea=t(5806);function Oa(){var e=Object(b.a)(["\n  mutation AddEntryItem($id: ID!, $fields: JournalEntryAddItemFields!) {\n    journalEntryAddItem(id: $id, fields: $fields) {\n      journalEntry {\n        ...JournalEntry_1Fragment\n      }\n    }\n  }\n  ","\n"]);return Oa=function(){return e},e}var ja=y()(Oa(),_e),ga=function(){var e=Object(N.a)(V.a.mark((function e(n,t,a){var r,l,o,i,u;return V.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=function(){var e,n,t,r=(null===(e=a.category)||void 0===e?void 0:e.value)||[];return null!==(n=null===(t=r[r.length-1])||void 0===t?void 0:t.id)&&void 0!==n?n:null}(),o=function(){var e;return(null===(e=a.department)||void 0===e?void 0:e.id)||null}(),i=a.units,u={id:t,fields:{units:i,category:l,department:o,description:(null===(r=a.description)||void 0===r?void 0:r.trim())||null,total:a.total.value}},e.next=6,n.mutate({mutation:ja,variables:u});case 6:case"end":return e.stop()}}),e)})));return function(n,t,a){return e.apply(this,arguments)}}(),ha={min:"1",step:"1",type:"number"},Ra=Symbol(),Ca=function(e){var n,t=e.autoFocus,l=void 0!==t&&t,o=e.disabled,i=void 0!==o&&o,u=e.variant,c=void 0===u?"filled":u,d=Object(gn.a)(e,["autoFocus","disabled","variant"]),s=Object(a.useCallback)((function(e){var n;return(null!==(n=e=e||null)&&void 0!==n?n:Ra)===Ra?"Units Required":0===e?"Cannot be 0":e<0?"Units must be 1 or greater":void 0}),[]),m=Object(We.b)({name:"units",validate:s}),p=Object(B.a)(m,3),f=p[0],b=p[1],v=p[2].setValue,y=null!==(n=f.value)&&void 0!==n?n:"",E=b.error,O=b.touched,j=vn(),g=Object(B.a)(j,1)[0],h=Object(a.useMemo)((function(){return{type:"number",autoFocus:l}}),[l]),R=Object(a.useCallback)((function(e){var n,t=(null===e||void 0===e||null===(n=e.target)||void 0===n?void 0:n.value)||0;v(Math.max("number"===typeof t?t:Number.parseInt(t),0))}),[v]);return r.a.createElement(hn.a,Object.assign({},d,f,{disabled:i||(null===g||void 0===g?void 0:g.type)===rn.FATAL_ERROR,type:"number",value:y,error:O&&!!E,helperText:O&&E?E:void 0,placeholder:"1",label:"Units",name:"units",required:!0,variant:c,inputProps:ha,InputProps:h,onChange:R}))};function Ma(){var e=Object(b.a)(["\n  fragment JournalEntry_3Fragment on JournalEntry {\n    __typename\n    id\n    type\n    total {\n      n\n      d\n      s\n    }\n    items {\n      id\n      __typename\n      deleted\n      total {\n        n\n        d\n        s\n      }\n    }\n  }\n"]);return Ma=function(){return e},e}var _a=y()(Ma());function Ia(){var e=Object(b.a)(["\n  query GetEntryItemState_1($id: ID!) {\n    journalEntry(id: $id) {\n      ...JournalEntry_3Fragment\n    }\n  }\n  ","\n"]);return Ia=function(){return e},e}var ka=y()(Ia(),_a),Aa={item:!0,lg:4,sm:6,xs:12},Sa=function(e){var n,t,l,o,i=e.entryId,u=e.open,c=e.onClose,d=e.onExited,s=Object(We.c)(),m=s.resetForm,p=s.isSubmitting,f=s.isValid,b=s.submitForm,v=vn(),y=Object(B.a)(v,2),E=y[0],O=y[1],j=Object(a.useCallback)((function(e){return O({msg:e.message,type:rn.FATAL_ERROR})}),[O]),g=Object(G.c)(ka,{skip:!i,variables:{id:i},onError:j}),h=g.loading,R=g.data,C=null!==(n=null===R||void 0===R||null===(t=R.journalEntry)||void 0===t?void 0:t.type)&&void 0!==n?n:null,M=null===R||void 0===R||null===(l=R.journalEntry)||void 0===l?void 0:l.total,_=(null===R||void 0===R||null===(o=R.journalEntry)||void 0===o?void 0:o.items)||[],I=Object(a.useMemo)((function(){if(M){var e=_.reduce((function(e,n){var t=n.deleted,a=n.total;return t?e:e.add(_n(a))}),new tn.a(0));return _n(M).sub(e)}return new tn.a(Number.MAX_SAFE_INTEGER)}),[M,_]),k=Object(a.useCallback)((function(){d(),m(),O(null)}),[m,d,O]),A=Object(a.useMemo)((function(){return!E||E.type!==rn.FATAL_ERROR&&E.type!==rn.ERROR?[null,null]:[E.msg,E.type===rn.FATAL_ERROR]}),[E]),S=Object(B.a)(A,2),w=S[0],x=S[1],D=Object(a.useMemo)((function(){return x?"Fatal Error":h?"Loading ".concat("Add Item","..."):p?"Submitting ".concat("Add Item"):"Add Item"}),[h,x,p]),F=Object(ze.a)(),T=Object(a.useCallback)(Object(N.a)(V.a.mark((function e(){var n;return V.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,O(null),e.next=4,b();case 4:c(),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),O({msg:null!==(n=e.t0.message)&&void 0!==n?n:"".concat(e.t0),type:rn.ERROR});case 10:case"end":return e.stop()}}),e,null,[[0,7]])}))),[b,c,O]),P=Object(a.useCallback)(Object(N.a)(V.a.mark((function e(){var n;return V.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,O(null),e.next=4,b();case 4:m(),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),O({msg:null!==(n=e.t0.message)&&void 0!==n?n:"".concat(e.t0),type:rn.ERROR});case 10:case"end":return e.stop()}}),e,null,[[0,7]])}))),[b,m,O]),$=Object(a.useCallback)((function(e){return e.preventDefault()}),[]);return r.a.createElement(qe.a,{open:u,onClose:c,onExited:k,disableBackdropClick:p,disableEscapeKeyDown:p,fullWidth:!0,maxWidth:"lg",PaperProps:{component:"form",onSubmit:$}},r.a.createElement(Ge.a,{style:w?{color:F.palette.error.main}:void 0},D),r.a.createElement(ae.a,{position:"relative"},(h||p)&&!w&&r.a.createElement(at,{zIndex:"modal"}),!!w&&x&&r.a.createElement(tt,{opacity:.78,zIndex:"modal",padding:2},r.a.createElement(Ke.a,{color:"error"},w)),r.a.createElement(Xe.a,{dividers:!0},!!w&&!x&&r.a.createElement(Ke.a,{color:"error"},w),r.a.createElement(Qe.a,{container:!0,spacing:2},r.a.createElement(Qe.a,Aa,r.a.createElement(An,{disabled:h||p,fullWidth:!0,maxTotal:I})),r.a.createElement(Qe.a,Aa,r.a.createElement(Ca,{disabled:h||p,fullWidth:!0})),r.a.createElement(Qe.a,Aa,r.a.createElement(Rn,{disabled:h||p,fullWidth:!0})),r.a.createElement(Qe.a,Aa,r.a.createElement(At,{disabled:h||p||!!x,entryType:C,fullWidth:!0})),r.a.createElement(Qe.a,Aa,r.a.createElement(Ft,{disabled:h||p||!!x,fullWidth:!0}))))),r.a.createElement(He.a,null,!x&&r.a.createElement(r.a.Fragment,null,r.a.createElement(Ye.a,{onClick:T,disabled:h||p||!f,type:"submit",startIcon:r.a.createElement(Ze.a,null),color:"primary",variant:"contained"},"Add"),r.a.createElement(Ye.a,{onClick:P,disabled:h||p||!f,type:"submit",startIcon:r.a.createElement(Ot.a,null),variant:"outlined"},"Add & New")),r.a.createElement(Ye.a,{disabled:h||p,color:x?"primary":"default",startIcon:!x&&r.a.createElement(en.a,null),onClick:c},x?"Ok":"Cancel")))},wa=function(e){var n=e.entryId,t=e.open,l=e.onClose,o=e.onExited,i=Object(a.useMemo)((function(){return{}}),[]),u=Object(G.a)(),c=Object(a.useCallback)((function(e,t){return ga(u,n||"",e,t)}),[u,n]),d=Object(a.useCallback)((function(e){return r.a.createElement(Sa,{entryId:n,open:t,onClose:l,onExited:o,handleSubmit:e.handleSubmit})}),[n,t,l,o]);return r.a.createElement(We.a,{initialValues:i,initialStatus:null,enableReinitialize:!0,onSubmit:c,children:d})};function xa(){var e=Object(b.a)(["\n  mutation UpdateEntryItem($id: ID!, $fields: JournalEntryUpdateItemFields!) {\n    journalEntryUpdateItem(id: $id, fields: $fields) {\n      journalEntryItem {\n        ...JournalEntryItem_1Fragment\n      }\n    }\n  }\n  ","\n"]);return xa=function(){return e},e}var Da=y()(xa(),Me),Fa=function(){var e=Object(N.a)(V.a.mark((function e(n,t,a,r){var l,o,i,u,c,d,s,m,p,f,b;return V.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d=r.description!==t.description&&(null===(l=r.description)||void 0===l?void 0:l.trim())||null,s=(null===(o=r.department)||void 0===o?void 0:o.id)===(null===(i=t.department)||void 0===i?void 0:i.id)?null:null!==(u=null===(c=r.department)||void 0===c?void 0:c.id)&&void 0!==u?u:null,m=function(){var e,n,a,l,o=null!==(e=null===(n=r.category.value[r.category.value.length-1])||void 0===n?void 0:n.id)&&void 0!==e?e:null;return o===(null!==(a=null===(l=t.category.value[t.category.value.length-1])||void 0===l?void 0:l.id)&&void 0!==a?a:null)?null:o}(),p=r.units===t.units?null:r.units,f=0===_n(r.total.value).compare(_n(t.total.value))?null:r.total.value,b={id:a,fields:{units:p,description:d,department:s,category:m,total:f}},e.next=8,n.mutate({mutation:Da,variables:b});case 8:case"end":return e.stop()}}),e)})));return function(n,t,a,r){return e.apply(this,arguments)}}();function Ta(){var e=Object(b.a)(["\n  query UpdateItemIniState($entryId: ID!, $itemId: ID!) {\n    journalEntry(id: $entryId) {\n      ...JournalEntry_3Fragment\n    }\n    journalEntryItem(id: $itemId) {\n      __typename\n      id\n      department {\n        ...DeptEntryOptFragment\n      }\n      category {\n        ...CatEntryOptFragment\n        ancestors {\n          ...CatEntryOptFragment\n        }\n      }\n      description\n      units\n      total {\n        n\n        d\n        s\n      }\n    }\n  }\n  ","\n  ","\n  ","\n"]);return Ta=function(){return e},e}var Pa=y()(Ta(),_a,Bn,Ln),$a={item:!0,lg:4,sm:6,xs:12},Ua=function(e){var n,t=e.itemId,l=e.open,o=e.onClose,i=e.onExited,u=e.journalEntry,c=e.loading,d=e.handleSubmit,s=Object(We.c)(),m=s.resetForm,p=s.isSubmitting,f=s.isValid,b=vn(),v=Object(B.a)(b,2),y=v[0],E=v[1],O=null!==(n=null===u||void 0===u?void 0:u.type)&&void 0!==n?n:null,j=null===u||void 0===u?void 0:u.total,g=(null===u||void 0===u?void 0:u.items)||[],h=Object(a.useMemo)((function(){if(j){var e=g.reduce((function(e,n){var a=n.id,r=n.deleted,l=n.total;return r||a===t?e:e.add(_n(l))}),new tn.a(0));return _n(j).sub(e)}return new tn.a(Number.MAX_SAFE_INTEGER)}),[j,g,t]),R=Object(a.useCallback)((function(){i(),m(),E(null)}),[m,i,E]),C=Object(a.useMemo)((function(){return!y||y.type!==rn.FATAL_ERROR&&y.type!==rn.ERROR?[null,null]:[y.msg,y.type===rn.FATAL_ERROR]}),[y]),M=Object(B.a)(C,2),_=M[0],I=M[1],k=Object(a.useMemo)((function(){var e="Item Update";return I?"Fatal Error":c?"Loading ".concat(e,"..."):p?"Submitting ".concat(e):e}),[c,I,p]),A=Object(ze.a)();return r.a.createElement(qe.a,{open:l,onClose:o,onExited:R,disableBackdropClick:p,disableEscapeKeyDown:p,fullWidth:!0,maxWidth:"lg",PaperProps:{component:"form",onSubmit:d}},r.a.createElement(Ge.a,{style:_?{color:A.palette.error.main}:void 0},k),r.a.createElement(ae.a,{position:"relative"},(c||p)&&!_&&r.a.createElement(at,{zIndex:"modal"}),!!_&&I&&r.a.createElement(tt,{opacity:.78,zIndex:"modal",padding:2},r.a.createElement(Ke.a,{color:"error"},_)),r.a.createElement(Xe.a,{dividers:!0},!!_&&!I&&r.a.createElement(Ke.a,{color:"error"},_),r.a.createElement(Qe.a,{container:!0,spacing:2},r.a.createElement(Qe.a,$a,r.a.createElement(An,{disabled:c||p,fullWidth:!0,maxTotal:h})),r.a.createElement(Qe.a,$a,r.a.createElement(Ca,{disabled:c||p,fullWidth:!0})),r.a.createElement(Qe.a,$a,r.a.createElement(Rn,{disabled:c||p,fullWidth:!0})),r.a.createElement(Qe.a,$a,r.a.createElement(At,{disabled:c||p||!!I,entryType:O,fullWidth:!0})),r.a.createElement(Qe.a,$a,r.a.createElement(Ft,{disabled:c||p||!!I,fullWidth:!0}))))),r.a.createElement(He.a,null,!I&&r.a.createElement(Ye.a,{disabled:c||p||!f,type:"submit",startIcon:r.a.createElement(Ze.a,null),color:"primary",variant:"contained"},"Update"),r.a.createElement(Ye.a,{disabled:c||p||!!I,color:I?"primary":"default",startIcon:!I&&r.a.createElement(en.a,null),onClick:o},I?"Ok":"Cancel")))},Na=function(e){var n=e.entryId,t=e.itemId,l=e.open,o=e.onClose,i=e.onExited,u=Object(G.c)(Pa,{skip:!n,variables:{entryId:n,itemId:t}}),c=u.loading,d=u.error,s=u.data,m=Object(a.useMemo)((function(){return d?{msg:d.message,type:rn.FATAL_ERROR}:null}),[d]),p=null===s||void 0===s?void 0:s.journalEntryItem,f=Object(a.useMemo)((function(){var e,n;if(!p)return{};var t={inputValue:_n(p.total).round(2).toString(),value:p.total},a=function(){if(!p.category)return{inputValue:"",value:[]};var e=p.category,n=e.ancestors,t=Object(gn.a)(e,["ancestors"]),a=Object(J.a)(n).sort((function(e,n){var t,a;return e.id===(null===(t=n.parent)||void 0===t?void 0:t.id)?-1:n.id===(null===(a=e.parent)||void 0===a?void 0:a.id)?1:0}));return a.push(t),{inputValue:"",value:a}}(),r=null!==(e=p.department)&&void 0!==e?e:null,l=null!==(n=p.description)&&void 0!==n?n:null;return{total:t,units:p.units,category:a,department:r,description:l}}),[p]),b=Object(G.a)(),v=Object(a.useCallback)(function(){var e=Object(N.a)(V.a.mark((function e(n,a){var r;return V.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f){e.next=5;break}return a.setStatus({msg:'Failed to load initial values for item "'.concat(t,'".'),type:rn.FATAL_ERROR}),e.abrupt("return");case 5:if(t){e.next=8;break}return a.setStatus({msg:"No item ID.",type:rn.FATAL_ERROR}),e.abrupt("return");case 8:return e.prev=8,a.setStatus(null),e.next=12,Fa(b,f,t,n,a);case 12:o(),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(8),a.setStatus({msg:null!==(r=null===e.t0||void 0===e.t0?void 0:e.t0.message)&&void 0!==r?r:"".concat(e.t0),type:rn.FATAL_ERROR});case 18:case"end":return e.stop()}}),e,null,[[8,15]])})));return function(n,t){return e.apply(this,arguments)}}(),[b,f,o,t]),y=Object(a.useCallback)((function(e){var a;return r.a.createElement(Ua,{entryId:n,itemId:t,open:l,onClose:o,onExited:i,journalEntry:null!==(a=null===s||void 0===s?void 0:s.journalEntry)&&void 0!==a?a:null,loading:c,handleSubmit:e.handleSubmit})}),[s,n,c,o,i,l,t]);return r.a.createElement(We.a,{initialValues:null!==f&&void 0!==f?f:{},initialStatus:m,enableReinitialize:!0,onSubmit:v,children:y})};function Ja(){var e=Object(b.a)(["\n  mutation DeleteItem($id: ID!) {\n    journalEntryDeleteItem(id: $id) {\n      journalEntryItem {\n        id\n        __typename\n        deleted\n      }\n    }\n  }\n"]);return Ja=function(){return e},e}var Ba,La=y()(Ja()),Va=function(e){var n=e.itemId,t=e.onClose,l=Object(G.b)(La),o=Object(B.a)(l,2),i=o[0],u=o[1],c=u.loading,d=u.error,s=!!d,m=Object(a.useCallback)((function(e){i({variables:{id:n}}).then((function(){return t()}))}),[n,i,t]),p=Object(a.useMemo)((function(){return s?"Error":c?"Deleting Item...":"Delete Item"}),[s,c]),f=Object(ze.a)();return r.a.createElement(qe.a,{open:!!n,maxWidth:"sm",fullWidth:!0,disableBackdropClick:c,disableEscapeKeyDown:c,onClose:t},r.a.createElement(Ge.a,{style:s?{color:f.palette.error.main}:void 0},p),r.a.createElement(ae.a,{position:"relative"},c&&r.a.createElement(at,{zIndex:"modal"}),r.a.createElement(Xe.a,null,s&&r.a.createElement(Ke.a,{color:"error"},null===d||void 0===d?void 0:d.message),!s&&r.a.createElement(Ke.a,null,"Are you sure you want to delete this item?"))),r.a.createElement(He.a,null,!s&&r.a.createElement(Ye.a,{disabled:c,onClick:m,startIcon:r.a.createElement(ee.a,null),color:"primary",variant:"contained"},"Delete"),r.a.createElement(Ye.a,{disabled:c,startIcon:!s&&r.a.createElement(en.a,null),onClick:t},s?"Close":"Cancel")))},Wa=function(e){var n,t,l=e.entry,o=l.items,i=l.category,u=l.description,c=l.department,d=l.id,s=Object(a.useState)(!1),m=Object(B.a)(s,2),p=m[0],f=m[1],b=Object(a.useState)(null),v=Object(B.a)(b,2),y=v[0],E=v[1],O=Object(a.useCallback)((function(){f(!1)}),[f]),j=Object(a.useCallback)((function(){E(null)}),[E]),g=Object(a.useState)(!1),h=Object(B.a)(g,2),R=h[0],C=h[1],M=Object(a.useState)(null),_=Object(B.a)(M,2),I=_[0],k=_[1],A=Object(a.useState)(null),S=Object(B.a)(A,2),w=S[0],x=S[1],D=Object(a.useCallback)((function(){x(null)}),[x]),F=Object(a.useCallback)((function(){C(!1)}),[C]),T=Object(a.useCallback)((function(){k(null)}),[k]),P=Object(a.useMemo)((function(){return[{icon:ee.a,tooltip:"Delete Item",onClick:function(e,n){return x(n.id)}},{icon:ne.a,tooltip:"Edit Item",onClick:function(e,n){C(!0),k({entryId:d,itemId:n.id})}},{icon:function(e){return r.a.createElement(te.a,e)},iconProps:{color:"secondary",fontSize:"large"},tooltip:"Add Item",isFreeAction:!0,onClick:function(){f(!0),E(d)}}]}),[d]),$=Object(a.useMemo)((function(){return[{field:"total",title:"Total",render:function(e){var n=e.total;return X()(_n(n).valueOf()).format("$0,0.00")}},{field:"units",title:"Units"},{field:"description",title:"Description",render:function(e){var n;return(null===(n=e.description)||void 0===n?void 0:n.trim())||u}},{field:"category",title:"Category",render:function(e,n){var t,a,r=null!==(t=null===(a=e.category)||void 0===a?void 0:a.name)&&void 0!==t?t:i.name;return Object(Q.a)(r)}},{field:"department",title:"Department",render:function(e){var n,t,a=null!==(n=null===(t=e.department)||void 0===t?void 0:t.name)&&void 0!==n?n:c.name;return Object(Q.a)(a)}}]}),[i,u,c]),U=Object(a.useMemo)((function(){return{search:!1,emptyRowsWhenPaging:!1}}),[]),N=Object(a.useMemo)((function(){return o.filter((function(e){return!e.deleted}))}),[o]),J=Object(ze.a)(),L=Object(a.useMemo)((function(){return{boxShadow:J.shadows[0]}}),[J.shadows]),V=Object(a.useMemo)((function(){return{backgroundColor:J.palette.primary.main}}),[J.palette.primary.main]);return r.a.createElement(ae.a,null,r.a.createElement(q.a,{title:"Items",actions:P,options:U,columns:$,icons:Ve,data:N,style:L}),r.a.createElement(wa,{entryId:y,open:p,onClose:O,onExited:j}),r.a.createElement(Na,{entryId:null!==(n=null===I||void 0===I?void 0:I.entryId)&&void 0!==n?n:null,itemId:null!==(t=null===I||void 0===I?void 0:I.itemId)&&void 0!==t?t:null,open:R,onClose:F,onExited:T}),r.a.createElement(Va,{itemId:w,onClose:D}),r.a.createElement(Ea.a,{style:V}))};function za(){var e=Object(b.a)(["\n  mutation ReconcileRefund($id: ID!) {\n    journalEntryUpdateRefund(id: $id, fields: { reconciled: true }) {\n      ...JournalEntry_1Fragment\n    }\n  }\n  ","\n"]);return za=function(){return e},e}function qa(){var e=Object(b.a)(["\n  mutation ReconcileEntry($id: ID!) {\n    journalEntryUpdate(id: $id, fields: { reconciled: true }) {\n      ...JournalEntry_1Fragment\n    }\n  }\n  ","\n"]);return qa=function(){return e},e}function Ga(){var e=Object(b.a)(["\n  subscription OnEntryUpsert_1 {\n    journalEntryUpserted {\n      ...JournalEntry_1Fragment\n      department {\n        ancestors {\n          ... on Department {\n            __typename\n            id\n          }\n        }\n      }\n    }\n  }\n  ","\n"]);return Ga=function(){return e},e}!function(e){e[e.View=0]="View",e[e.Reconcile=1]="Reconcile"}(Ba||(Ba={}));var Ka=V.a.mark((function e(n,t){var a,r,l,o,i,u,c;return V.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n;case 2:a=n.type===h.Credit?h.Debit:h.Credit,r=!0,l=!1,o=void 0,e.prev=6,i=n.refunds[Symbol.iterator]();case 8:if(r=(u=i.next()).done){e.next=15;break}return c=u.value,e.next=12,Object(W.a)({},n,{},c,{type:a,description:c.description||n.description,refunds:n.id});case 12:r=!0,e.next=8;break;case 15:e.next=21;break;case 17:e.prev=17,e.t0=e.catch(6),l=!0,o=e.t0;case 21:e.prev=21,e.prev=22,r||null==i.return||i.return();case 24:if(e.prev=24,!l){e.next=27;break}throw o;case 27:return e.finish(24);case 28:return e.finish(21);case 29:if(t!==Ba.Reconcile){e.next=31;break}return e.abrupt("return");case 31:case"end":return e.stop()}}),e,null,[[6,17,21,29],[22,,24,28]])})),Xa=y()(Ga(),_e),Qa=y()(qa(),_e),Ha=y()(za(),_e),Ya=function(e){var n,t,l=e.deptId,o=void 0===l?null:l,i=e.journalTitle,u=void 0===i?null:i,c=e.mode,d=Object(a.useState)(!1),s=Object(B.a)(d,2),m=s[0],p=s[1],f=Object(a.useCallback)((function(){p(!1)}),[p]),b=Object(a.useState)(!1),v=Object(B.a)(b,2),y=v[0],E=v[1],O=Object(a.useState)(null),j=Object(B.a)(O,2),g=j[0],R=j[1],C=Object(a.useCallback)((function(){E(!1)}),[E]),M=Object(a.useCallback)((function(){R(null)}),[R]),_=Object(a.useState)(null),I=Object(B.a)(_,2),k=I[0],A=I[1],S=Object(a.useCallback)((function(){A(null)}),[A]),w=Object(a.useState)(!1),x=Object(B.a)(w,2),D=x[0],F=x[1],T=Object(a.useState)(null),P=Object(B.a)(T,2),$=P[0],U=P[1],L=Object(a.useCallback)((function(){F(!1)}),[F]),K=Object(a.useCallback)((function(){U(null)}),[U]),me=Object(a.useState)(!1),pe=Object(B.a)(me,2),fe=pe[0],be=pe[1],ve=Object(a.useState)(null),ye=Object(B.a)(ve,2),Ee=ye[0],Oe=ye[1],je=Object(a.useCallback)((function(){be(!1)}),[be]),ge=Object(a.useCallback)((function(){Oe(null)}),[Oe]),he=Object(a.useState)(null),Re=Object(B.a)(he,2),Ce=Re[0],Me=Re[1],_e=Object(a.useCallback)((function(){Me(null)}),[Me]),Ae=Object(G.b)(Qa),Se=Object(B.a)(Ae,2),we=Se[0],xe=Se[1].loading,De=Object(G.b)(Ha),Fe=Object(B.a)(De,2),Te=Fe[0],Pe=Fe[1].loading,$e=Object(a.useMemo)((function(){return o?{where:{department:{eq:o,matchDecedentTree:!0}}}:void 0}),[o]),Ue=Object(G.c)(Ie,{variables:$e,fetchPolicy:"cache-and-network"}),Ne=Ue.loading,Je=Ue.error,Be=Ue.data,Le=Ue.subscribeToMore,We=Ne&&!(null===Be||void 0===Be?void 0:Be.journalEntries);Object(a.useEffect)((function(){return Le({document:Xa,updateQuery:function(e,n){var t=n.subscriptionData;if(!t.data)return e;var a=t.data.journalEntryUpserted,r=a.department.ancestors;if(o&&a.department.id!==o&&r.every((function(e){return e.id!==o}))){var l=e.journalEntries.filter((function(e){return e.id!==a.id}));return l.length===e.journalEntries.length?e:Object.assign({},e,{journalEntries:l})}return e.journalEntries.some((function(e){return e.id===a.id}))?e:Object.assign({},e,{journalEntries:[a].concat(Object(J.a)(e.journalEntries))})}})}),[o,Le]);var ze=Object(a.useMemo)((function(){return[{field:"reconciled",title:"Reconciled",render:function(e){return e.reconciled?r.a.createElement(Y.a,null):null},sorting:!0,searchable:!0,customSort:function(e,n){return+e.reconciled-+n.reconciled},customFilterAndSearch:function(e,n){return n.reconciled?"reconciled"===(e||"").trim().toLowerCase():"!reconciled"===(e||"").trim().toLowerCase()},hidden:c===Ba.Reconcile,filtering:!1},{field:"total",title:"Total",render:function(e){var n=e.total;return X()(_n(n).valueOf()).format("$0,0.00")},searchable:!0,filtering:!1,sorting:!0,customSort:function(e,n){var t=e.total,a=n.total;return _n(t).sub(_n(a)).valueOf()},customFilterAndSearch:function(e,n){var t=n.total,a=_n(t).valueOf();return new H.a([{total:[X()(a).format("$0,0.00"),a.toFixed(2)]}],{threshold:.4,useExtendedSearch:!0,keys:["total"]}).search(e).length>0}},{field:"date",title:"Date",render:function(e){var n=e.date;return Object(se.a)(new Date(n),"MMM dd, yyyy")},searchable:!0,filtering:!1,sorting:!0,defaultSort:"desc",customSort:function(e,n){var t=e.date,a=n.date;return new Date(t).getTime()-new Date(a).getTime()},customFilterAndSearch:function(e,n){var t=n.date,a=new Date(t);return new H.a([{date:[t,Object(se.a)(a,"M/d/yy"),Object(se.a)(a,"MM/d/yy"),Object(se.a)(a,"M/d/yyyy"),Object(se.a)(a,"MM/d/yyyy"),Object(se.a)(a,"MMM dd, yyyy")]}],{threshold:.4,useExtendedSearch:!0,keys:["date"]}).search(e).length>0}},{field:"category",title:"Category",render:function(e,n){var t="group"===n?e.name:e.category.name;return Object(Q.a)(t)},searchable:!0,filtering:!1,sorting:!0,customSort:function(e,n){var t=e.category,a=n.category,r=t.name.toUpperCase(),l=a.name.toUpperCase();return r<l?-1:r>l?1:0},customFilterAndSearch:function(e,n){var t=n.category.name;return new H.a([{category:[t]}],{threshold:.4,useExtendedSearch:!0,keys:["category"]}).search(e).length>0}},{field:"source",title:"Source",render:function(e){var n=e.source;switch(n.__typename){case"Person":return"".concat(n.name.first," ").concat(n.name.last);case"Business":return n.bizName;case"Department":return n.deptName}},searchable:!0,filtering:!1,sorting:!0,customSort:function(e,n){var t=e.source,a=n.source,r=function(){switch(t.__typename){case"Person":return t.name.last.toUpperCase();case"Business":return t.bizName.toUpperCase();case"Department":return t.deptName.toUpperCase()}}(),l=function(){switch(a.__typename){case"Person":return a.name.last.toUpperCase();case"Business":return a.bizName.toUpperCase();case"Department":return a.deptName.toUpperCase()}}();return r<l?-1:r>l?1:0},customFilterAndSearch:function(e,n){var t=n.source;return new H.a([{source:[function(){switch(t.__typename){case"Person":return"".concat(t.name.first," ").concat(t.name.last);case"Business":return t.bizName;case"Department":return t.deptName}}()]}],{threshold:.4,useExtendedSearch:!0,keys:["source"]}).search(e).length>0}},{field:"paymentMethod",title:"Payment Method",render:function(e){var n,t=e.paymentMethod;return(null===(n=t.parent)||void 0===n?void 0:n.id)===ke?"CK-".concat(t.name):t.name},searchable:!0,filtering:!1,sorting:!0,customSort:function(e,n){var t=e.paymentMethod,a=n.paymentMethod,r=function(){var e;return((null===(e=t.parent)||void 0===e?void 0:e.id)===ke?"CK-".concat(t.name):t.name).toUpperCase()}(),l=function(){var e;return((null===(e=a.parent)||void 0===e?void 0:e.id)===ke?"CK-".concat(a.name):a.name).toUpperCase()}();return r<l?-1:r>l?1:0},customFilterAndSearch:function(e,n){var t,a=n.paymentMethod;return new H.a([{paymentMethod:[(null===(t=a.parent)||void 0===t?void 0:t.id)===ke?"CK-".concat(a.name):a.name]}],{threshold:.4,useExtendedSearch:!0,keys:["paymentMethod"]}).search(e).length>0}},{field:"description",title:"Description",render:function(e){return e.description},searchable:!0,filtering:!1,sorting:!1,customFilterAndSearch:function(e,n){var t=n.description;return new H.a([{description:[(null===t||void 0===t?void 0:t.trim())||""]}],{threshold:.4,useExtendedSearch:!0,keys:["description"]}).search(e).length>0}},{field:"department",title:"Department",render:function(e){var n=e.department;return Object(Q.a)(n.name)},searchable:!0,filtering:!1,sorting:!0,customSort:function(e,n){var t=e.department,a=n.department,r=t.name.toUpperCase(),l=a.name.toUpperCase();return r<l?-1:r>l?1:0},customFilterAndSearch:function(e,n){var t=n.department;return new H.a([{department:[t.name]}],{threshold:.4,useExtendedSearch:!0,keys:["department"]}).search(e).length>0}}]}),[c]),qe=Object(a.useMemo)((function(){return{toolbar:{searchTooltip:r.a.createElement(ae.a,{fontSize:12,component:"span"},'[abc] | [efg] = "abc" OR "efg"',r.a.createElement("br",null),'\'[abc] = EXACTLY "abc"',r.a.createElement("br",null),'![abc] = NOT "abc"',r.a.createElement("br",null),'^[abc] = STARTS WITH "abc"',r.a.createElement("br",null),'!^[abc] = DOES NOT START WITH "abc"',r.a.createElement("br",null),'[abc]$ = ENDS WITH "abc"',r.a.createElement("br",null),'![abc]$ = DOES NOT END WITH "abc"'),nRowsSelected:"Reconcile {0} Entry(s)"}}}),[]),Ge=Object(a.useMemo)((function(){return{rowStyle:function(e){var n={};return n.color=e.type===h.Credit?ue.a[900]:ce.a[900],n},maxBodyHeight:"calc(100vh - 53px - 64px)",headerStyle:{position:"sticky",top:0},pageSize:25,pageSizeOptions:[25,50,100],showTitle:!!u,selection:c===Ba.Reconcile,showSelectAllCheckbox:!1,debounceInterval:500,emptyRowsWhenPaging:!1,columnsButton:!0}}),[u,c]),Ke=Object(a.useMemo)((function(){return c===Ba.Reconcile?[{icon:function(e){return r.a.createElement(Z.a,e)},tooltip:"Reconcile Selected",position:"toolbarOnSelect",iconProps:{color:"secondary",fontSize:"large"},onClick:function(){var e=Object(N.a)(V.a.mark((function e(n,t){return V.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all((Array.isArray(t)?t:[t]).map(function(){var e=Object(N.a)(V.a.mark((function e(n){return V.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.reconciled){e.next=2;break}return e.abrupt("return");case 2:if(e.prev=2,"JournalEntryRefund"!==n.__typename){e.next=8;break}return e.next=6,Te({variables:{id:n.id}});case 6:e.next=10;break;case 8:return e.next=10,we({variables:{id:n.id}});case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),console.error(e.t0);case 15:case"end":return e.stop()}}),e,null,[[2,12]])})));return function(n){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}()}]:[function(e){var n=function(){switch(e.__typename){case"JournalEntry":return{tooltip:"Delete Entry",onClick:function(e,n){return A(n.id)}};case"JournalEntryRefund":return{tooltip:"Delete Refund",onClick:function(e,n){return Me(n.id)}}}}(),t=n.tooltip,a=n.onClick;return{icon:ee.a,tooltip:t,onClick:a}},function(e){var n=function(){switch(e.__typename){case"JournalEntry":return{tooltip:"Edit Entry",onClick:function(e,n){E(!0),R(n.id)}};case"JournalEntryRefund":return{tooltip:"Edit Refund",onClick:function(e,n){be(!0),Oe({entryId:n.refunds,refundId:n.id})}}}}(),t=n.tooltip,a=n.onClick;return{icon:ne.a,tooltip:t,onClick:a}},function(e){if("JournalEntry"!==e.__typename)return null;var n=e.type===h.Credit;return{icon:function(e){return n?r.a.createElement(de.d,e):r.a.createElement(de.c,e)},tooltip:n?"Give Refund":"Add Refund",iconProps:{style:{color:n?ce.a[900]:ue.a[900]}},onClick:function(e,n){F(!0),U(n.id)}}},{icon:function(e){return r.a.createElement(te.a,e)},iconProps:{color:"secondary",fontSize:"large"},tooltip:"Add Entry",isFreeAction:!0,onClick:function(){p(!0)}}]}),[c,Te,we,Me,A]),Xe=Object(a.useMemo)((function(){return{Body:Je?function(e){return r.a.createElement(re.a,e,r.a.createElement(le.a,null,r.a.createElement(oe.a,{colSpan:ze.length+(Array.isArray(Ke)&&Ke.length>0?1:0),align:"left"},r.a.createElement(ie.a,{align:"center",color:"error",variant:"h4"},"Error Loading Entries"),r.a.createElement(ie.a,{variant:"body1"},Je.message))))}:function(e){return r.a.createElement(z.MTableBody,e)}}}),[Je,ze.length,Ke]),Qe=Object(a.useMemo)((function(){return[function(e){var n="JournalEntry"===e.__typename,t=!!n&&e.items.length>0;return{icon:function(e){return n?t?r.a.createElement(de.e,e):r.a.createElement(de.f,e):null},openIcon:function(e){return t?r.a.createElement(de.e,Object.assign({},e,{color:"primary"})):r.a.createElement(de.f,Object.assign({},e,{color:"primary"}))},disabled:!n,tooltip:n?"Itemize":void 0,render:function(e){return"JournalEntry"!==e.__typename?null:r.a.createElement(Wa,{entry:e})}}}]}),[]),He=(null===Be||void 0===Be?void 0:Be.journalEntries)||[],Ye=Object(a.useRef)(new Map),Ze=Object(a.useMemo)((function(){var e=Ye.current,n=new Map,t=c===Ba.Reconcile?[function(e){return!e.reconciled&&!e.deleted}]:[function(e){return!e.deleted}],a=He.reduce((function(a,r){var l=!0,o=!1,i=void 0;try{for(var u,d=function(){var r=u.value;if(t.every((function(e){return e(r)}))){var l,o=(null!==(l=e.get(r.id))&&void 0!==l?l:{}).tableData;r=Object(W.a)({},r,{tableData:o}),n.set(r.id,r),a.push(r)}},s=Ka(r,c)[Symbol.iterator]();!(l=(u=s.next()).done);l=!0)d()}catch(m){o=!0,i=m}finally{try{l||null==s.return||s.return()}finally{if(o)throw i}}return a}),[]).sort((function(e,n){return new Date(n.date).getTime()-new Date(e.date).getTime()}));return Ye.current=n,a}),[He,c,Ye]);return r.a.createElement(r.a.Fragment,null,r.a.createElement(q.a,{icons:Ve,isLoading:We||xe||Pe,columns:ze,data:Ze,options:Ge,localization:qe,actions:Ke,components:Xe,title:null!==u&&void 0!==u?u:void 0,detailPanel:Qe}),r.a.createElement(ta,{deptId:o,open:m,onClose:f}),r.a.createElement(sa,{entryId:g,open:y,onClose:C,onExited:M}),r.a.createElement(fa,{entryId:k,onClose:S}),r.a.createElement(dt,{entryId:$,open:D,onClose:L,onExited:K}),r.a.createElement(Et,{entryId:null!==(n=null===Ee||void 0===Ee?void 0:Ee.entryId)&&void 0!==n?n:null,refundId:null!==(t=null===Ee||void 0===Ee?void 0:Ee.refundId)&&void 0!==t?t:null,open:fe,onClose:je,onExited:ge}),r.a.createElement(ya,{refundId:Ce,onClose:_e}))},Za=t(5802),er=t(405),nr=t.n(er),tr=t(407),ar=t.n(tr),rr=t(409),lr=t.n(rr),or=t(408),ir=t.n(or),ur=t(5799),cr=t(5801),dr=t(5800),sr=t(162),mr=t(158);function pr(){var e=Object(b.a)(["\n  subscription JournalEntryUpdated_2 {\n    journalEntryUpdated {\n      ...GetReportDataEntry_1Fragment\n    }\n  }\n  ","\n"]);return pr=function(){return e},e}function fr(){var e=Object(b.a)(["\n  subscription JournalEntryAdded_2 {\n    journalEntryAdded {\n      ...GetReportDataEntry_1Fragment\n    }\n  }\n  ","\n"]);return fr=function(){return e},e}function br(){var e=Object(b.a)(["\n  query GetReportData($deptId:ID!, $where:JournalEntiresWhereInput!) {\n    department(id:$deptId) {\n      ...GetReportDataDept_1Fragment\n      descendants {\n        ...GetReportDataDept_1Fragment\n      }\n    }\n    journalEntries(where:$where) {\n      ...GetReportDataEntry_1Fragment\n    }\n  }\n  ",",\n  ","\n"]);return br=function(){return e},e}function vr(){var e=Object(b.a)(["\n  fragment GetReportDataEntry_1Fragment on JournalEntry {\n    id\n    __typename\n    category {\n      __typename\n      id\n      name\n    }\n    type\n    total {\n      n\n      d\n      s\n    }\n    department {\n      __typename\n      id\n      ancestors {\n        __typename\n        ... on Business {\n          id\n        }\n        ... on Department {\n          id\n        }\n      }\n    }\n    refunds {\n      __typename\n      id\n      total {\n        n\n        d\n        s\n      }\n      deleted\n      lastUpdate\n    }\n    lastUpdate\n    deleted\n  }\n"]);return vr=function(){return e},e}function yr(){var e=Object(b.a)(["\n  fragment GetReportDataDept_1Fragment on Department {\n    __typename\n    id\n    name\n    budget {\n      id\n      __typename\n      amount {\n        n\n        d\n        s\n      }\n    }\n  }\n"]);return yr=function(){return e},e}var Er=y()(yr()),Or=y()(vr()),jr=y()(br(),Er,Or);y()(fr(),Or),y()(pr(),Or);function gr(){var e=Object(b.a)(["\n  subscription OnEntryUpsert_2 {\n    journalEntryUpserted {\n      ...GetReportDataEntry_1Fragment\n      department {\n        ancestors {\n          ... on Department {\n            __typename\n            id\n          }\n        }\n      }\n    }\n  }\n  ","\n"]);return gr=function(){return e},e}function hr(){var e=Object(b.a)(["\n  query DeptForUpsertAdd($id: ID!) {\n    department(id: $id) {\n      ...DeptEntryOptFragment\n    }\n  }\n  ","\n"]);return hr=function(){return e},e}var Rr=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:800;return e<.75?ue.a[n]:e<.9?sr.a[n]:ce.a[n]},Cr=function(e){var n=e.spentPercentage,t=e.height;return r.a.createElement(ae.a,{height:t,bgcolor:Rr(n),display:"flex",justifyContent:"flex-start"},r.a.createElement(ae.a,{height:"100%",width:"".concat(100*n,"%"),bgcolor:mr.a[400]}))},Mr=(y()(hr(),Bn),y()(gr(),Or)),_r=function(e){var n,t=e.deptId,l=Object(a.useState)(!1),o=Object(B.a)(l,2),i=o[0],u=o[1],d=Object(a.useCallback)((function(){u(!1)}),[u]),s=Object(a.useMemo)((function(){return{deptId:t,where:{department:{eq:t,matchDecedentTree:!0},deleted:!1}}}),[t]),m=Object(G.c)(jr,{variables:s,fetchPolicy:"cache-and-network"}),p=m.loading,f=m.error,b=m.data,v=m.subscribeToMore,y=p&&!(null===b||void 0===b?void 0:b.journalEntries);Object(a.useEffect)((function(){return v({document:Mr,updateQuery:function(e,n){var a=n.subscriptionData;if(!a.data)return e;var r=a.data.journalEntryUpserted,l=r.department.ancestors;if(t&&r.department.id!==t&&l.every((function(e){return e.id!==t}))){var o=e.journalEntries.filter((function(e){return e.id!==r.id}));return o.length===e.journalEntries.length?e:Object.assign({},e,{journalEntries:o})}return e.journalEntries.some((function(e){return e.id===r.id}))?e:Object.assign({},e,{journalEntries:[r].concat(Object(J.a)(e.journalEntries))})}})}),[t,v]);var E=Object(a.useMemo)((function(){return((null===b||void 0===b?void 0:b.journalEntries)||[]).filter((function(e){return!e.deleted}))}),[b]),O=(null===b||void 0===b||null===(n=b.department)||void 0===n?void 0:n.name)||"";Object(a.useEffect)((function(){document.title=O}),[O]);var j=(null===b||void 0===b?void 0:b.department)||null,g=Object(a.useMemo)((function(){var e=new Map,n=new tn.a(0);if(j){var t=j.budget?_n(j.budget.amount):null;e.set(j.id,{name:j.name,spent:new tn.a(0),budget:t});var a=!0,r=!1,l=void 0;try{for(var o,i=j.descendants[Symbol.iterator]();!(a=(o=i.next()).done);a=!0){var u=o.value,c=null;if(u.budget){var d=_n(u.budget.amount);n=n.add(d),c=d}e.set(u.id,{name:u.name,spent:new tn.a(0),budget:c})}}catch(S){r=!0,l=S}finally{try{a||null==i.return||i.return()}finally{if(r)throw l}}}var s=new tn.a(0),m=!0,p=!1,f=void 0;try{for(var b,v=E[Symbol.iterator]();!(m=(b=v.next()).done);m=!0){var y=b.value;if(!y.deleted){var O=e.get(y.department.id),g=_n(y.total),R=!0,C=!1,M=void 0;try{for(var _,I=y.refunds[Symbol.iterator]();!(R=(_=I.next()).done);R=!0){var k=_.value;k.deleted||(g=g.sub(_n(k.total)))}}catch(S){C=!0,M=S}finally{try{R||null==I.return||I.return()}finally{if(C)throw M}}y.type===h.Credit?(s=s.sub(g),O.spent=O.spent.sub(g)):(s=s.add(g),O.spent=O.spent.add(g))}}}catch(S){p=!0,f=S}finally{try{m||null==v.return||v.return()}finally{if(p)throw f}}var A=(null===j||void 0===j?void 0:j.budget)?_n(j.budget.amount):n;return{totalRemaining:X()(A.sub(s).valueOf()).format("$0,0.00"),budget:X()(A.valueOf()).format("$0,0.00"),spentToBudgetRatio:0===A.n?new tn.a(1):s.div(A),deptReport:e}}),[E,j]),R=g.totalRemaining,C=g.budget,M=g.spentToBudgetRatio,_=g.deptReport,I=Object(a.useMemo)((function(){var e=[],n=!0,t=!1,a=void 0;try{for(var l,o=function(){var n=Object(B.a)(l.value,2),t=n[0],a=n[1],o=a.budget,i=a.spent,u=a.name;if(t===(null===j||void 0===j?void 0:j.id))return"continue";var c=r.a.createElement(Qe.a,{key:t,item:!0,xs:12,md:4,lg:3},r.a.createElement(ur.a,null,r.a.createElement(cr.a,{titleTypographyProps:{noWrap:!0},title:u}),r.a.createElement(dr.a,null,function(){if(null===o)return r.a.createElement(ae.a,{color:i.compare(new tn.a(0))>0?ce.a[900]:ue.a[900],clone:!0},r.a.createElement(ie.a,{variant:"h6"},"Spent: ".concat(X()(i.abs().valueOf()).format("$0,0.00"))));var e=o.sub(i);return r.a.createElement(r.a.Fragment,null,r.a.createElement(ae.a,{color:Rr(i.div(o).valueOf(),900),clone:!0},r.a.createElement(ie.a,{variant:"h6"},"".concat(X()(e.valueOf()).format("$0,0.00")," Remaining"))),r.a.createElement(ie.a,{variant:"body1"},"of ".concat(X()(o.valueOf()).format("$0,0.00"))),r.a.createElement(Cr,{spentPercentage:i.div(o).valueOf(),height:5}))}())));e.push(c)},i=_[Symbol.iterator]();!(n=(l=i.next()).done);n=!0)o()}catch(u){t=!0,a=u}finally{try{n||null==i.return||i.return()}finally{if(t)throw a}}return e}),[_,j]),k=Object(a.useCallback)((function(e){return u(!0)}),[u]);return y?r.a.createElement("p",null,"Loading..."):f?(console.error(f),r.a.createElement("p",null,f.message)):r.a.createElement(ae.a,{display:"flex",flexDirection:"column",overflow:"hidden",clone:!0},r.a.createElement(Za.a,null,r.a.createElement(ae.a,{padding:8},r.a.createElement(Qe.a,{container:!0,alignItems:"center",justify:"center",spacing:4},r.a.createElement(Qe.a,{item:!0},r.a.createElement(Ye.a,{variant:"contained",color:"secondary",startIcon:r.a.createElement(nr.a,null),children:"New Entry",onClick:k})),r.a.createElement(Qe.a,{item:!0},r.a.createElement(Ye.a,{component:c.b,to:"/journal/".concat(t,"/reconcile"),variant:"contained",startIcon:r.a.createElement(ar.a,null),children:"Reconcile"})),r.a.createElement(Qe.a,{item:!0},r.a.createElement(Ye.a,{variant:"contained",startIcon:r.a.createElement(ir.a,null),children:"Reports"})),r.a.createElement(Qe.a,{item:!0},r.a.createElement(Ye.a,{component:c.b,to:"/journal/".concat(t),variant:"contained",startIcon:r.a.createElement(lr.a,null),children:"Journal"})))),r.a.createElement(ae.a,{flexGrow:1,overflow:"auto"},r.a.createElement(Qe.a,{justify:"center",container:!0,spacing:2},r.a.createElement(Qe.a,{item:!0,xs:12},r.a.createElement(ie.a,{align:"center",variant:"h3"},O),r.a.createElement(ae.a,{color:Rr(M.valueOf())},r.a.createElement(ie.a,{align:"center",variant:"h4"},"".concat(R," Remaining"))),r.a.createElement(ie.a,{align:"center",variant:"subtitle1"},"of ".concat(C)),r.a.createElement(Cr,{spentPercentage:M.valueOf(),height:10})),I)),r.a.createElement(ta,{deptId:t,open:i,onClose:d})))},Ir=t(293),kr=t(359),Ar=t(295);function Sr(){var e=Object(b.a)(["\n  query DeptsForNav_1 {\n    departments {\n      __typename\n      id\n      name\n      parent {\n        __typename\n        ...on Business {\n          id\n        }\n        ...on Department {\n          id\n        }\n      }\n      virtualRoot\n    }\n  }\n"]);return Sr=function(){return e},e}var wr=y()(Sr()),xr=function(e){var n=Object(G.c)(wr),t=n.loading,l=n.error,o=n.data,i=Object(a.useState)(null),u=Object(B.a)(i,2),d=u[0],s=u[1],m=(null===o||void 0===o?void 0:o.departments)||[],p=Object(a.useMemo)((function(){var e=[],n=new Set,t=!0,a=!1,r=void 0;try{for(var l,o=m[Symbol.iterator]();!(t=(l=o.next()).done);t=!0){var i=l.value;"Business"===i.parent.__typename&&e.push(i),i.virtualRoot&&n.add(i.id)}}catch(u){a=!0,r=u}finally{try{t||null==o.return||o.return()}finally{if(a)throw r}}return{rootDepts:e,virtualRoots:n}}),[m]),f=p.rootDepts,b=p.virtualRoots,v=Object(a.useMemo)((function(){var e=[];if(d&&b.has(d)){var n=!0,t=!1,a=void 0;try{for(var r,l=m[Symbol.iterator]();!(n=(r=l.next()).done);n=!0){var o=r.value;o.parent.id===d&&e.push(o)}}catch(i){t=!0,a=i}finally{try{n||null==l.return||l.return()}finally{if(t)throw a}}}return e}),[b,d,m]);Object(a.useEffect)((function(){document.title="Select Department"}));var y=Object(a.useCallback)((function(e){var n;s((null===e||void 0===e||null===(n=e.target)||void 0===n?void 0:n.value)||null)}),[s]);if(t)return r.a.createElement("p",null,"Loading...");if(l)return r.a.createElement("p",null,l.message);var E=v.length>0;return r.a.createElement(ae.a,{flexGrow:1,display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column",clone:!0},r.a.createElement(Za.a,null,r.a.createElement(ae.a,{padding:4,clone:!0},r.a.createElement(ie.a,{align:"center",color:"primary",variant:"h3"},"Select Department")),r.a.createElement(ae.a,{minWidth:"250px !important",clone:!0},r.a.createElement(Gt.a,{variant:"filled"},r.a.createElement(Ir.a,null,"Department"),r.a.createElement(Ar.a,{value:d,onChange:y,autoWidth:!0},f.map((function(e){var n={component:c.b,to:"/department/".concat(e.id),key:e.id,value:e.id,children:e.name};return e.virtualRoot&&(delete n.component,delete n.to),r.a.createElement(kr.a,n)}))))),E&&r.a.createElement(ae.a,{pt:2},r.a.createElement(ae.a,{pt:2,minWidth:"250px !important",clone:!0},r.a.createElement(Gt.a,{variant:"filled"},r.a.createElement(Ir.a,null,"Sub Department"),r.a.createElement(Ar.a,{autoWidth:!0},v.map((function(e){var n={component:c.b,to:"/department/".concat(e.id),key:e.id,value:e.id,children:e.name};return r.a.createElement(kr.a,n)}))))))))};function Dr(){var e=Object(b.a)(["\n  query DepartmentName_1($id: ID!) {\n    department(id: $id) {\n      id\n      __typename\n      name\n    }\n  }\n"]);return Dr=function(){return e},e}var Fr=function(e){var n=Object(U.f)().id;return n?r.a.createElement(_r,{deptId:n}):r.a.createElement("div",null,"Error: No Dept ID!")},Tr=y()(Dr()),Pr=function(e){var n,t=Object(U.f)().id,a=Object(G.c)(Tr,{variables:{id:t}}),l=(a.loading,a.error,a.data),o=(null===l||void 0===l||null===(n=l.department)||void 0===n?void 0:n.name)?l.department.name:void 0;return r.a.createElement(Ya,{mode:Ba.View,deptId:t,journalTitle:o})},$r=function(e){var n,t=Object(U.f)().id,a=Object(G.c)(Tr,{variables:{id:t}}),l=(a.loading,a.error,a.data),o=(null===l||void 0===l||null===(n=l.department)||void 0===n?void 0:n.name)?"Reconcile ".concat(l.department.name):"Reconcile";return r.a.createElement(Ya,{mode:Ba.Reconcile,deptId:t,journalTitle:o})},Ur=function(e){return r.a.createElement(U.c,null,r.a.createElement(U.a,{exact:!0,path:"/",component:xr}),r.a.createElement(U.a,{exact:!0,path:"/department/:id",component:Fr}),r.a.createElement(U.a,{exact:!0,path:"/journal",component:Ya}),r.a.createElement(U.a,{exact:!0,path:"/journal/:id",component:Pr}),r.a.createElement(U.a,{exact:!0,path:"/journal/:id/reconcile",component:$r}))};function Nr(){return r.a.createElement(a.Fragment,null,r.a.createElement(u.a,null),r.a.createElement(i.a,{client:$},r.a.createElement(c.a,null,r.a.createElement(Ur,null))))}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(Nr,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[5660,1,2]]]);
//# sourceMappingURL=main.b8b5049f.chunk.js.map